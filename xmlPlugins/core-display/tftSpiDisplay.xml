<TcMenuPlugin name="TFT_eSPI display driver for color displays"
              id="e6342680-6fab-4d1b-ac08-ce8dbfc0974c" subsystem="DISPLAY"
              requiresDesigner="2.0" needsTheme="true"
              xmlns="https://www.thecoderscorner.com/libraries/tcmenuPluginItem" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="https://www.thecoderscorner.com/libraries/tcmenuPluginItem https://www.thecoderscorner.com/libraries/tcmenu-plugin-item.xsd">
    <SupportedPlatforms>
        <Platform>ARDUINO_32</Platform>
        <Platform>ARDUINO_ESP8266</Platform>
        <Platform>ARDUINO_ESP32</Platform>
        <Platform>STM32DUINO</Platform>
    </SupportedPlatforms>
    <Description>Draw menus using the TFT_eSPI library with any configuration that you have for color TFTs. Supports double buffering and all menu display types. Can use the library touch functions.</Description>
    <Documentation link="https://www.thecoderscorner.com/products/arduino-libraries/tc-menu/tcmenu-plugins/tft_espi-renderer-plugin/"/>
    <RequiredLibraries/>
    <ImageFile>adagfx-color.jpg</ImageFile>
    <Properties>
        <Property id="DISPLAY_VARIABLE" name="Display variable name" initial="gfx" desc="Name of the variable we should create" type="variable" />
        <Property id="DISPLAY_ROTATION" name="Rotation number" initial="2" desc="Rotation value between 0 and 3" type="int" min="0" max="3" />
        <Property id="DOUBLE_BUFFER_ROWS" name="Maximum rows to double buffer" initial="0" desc="Menus are rendered one item at a time, the largest buffer height - 0=off" type="int" min="0" max="250" />
        <Property id="UPDATES_PER_SEC" name="Screen updates per second" initial="10" desc="How many times per second to check for screen updates" type="int" min="1" max="30" />

        <Property id="TOUCH_SEPARATOR" name="Optional Touch settings (DEV test)" initial="" desc="Optional Settings for BSP touch controller" type="separator"/>
        <Property id="TFT_TOUCH_SCREEN_REQUIRED" name="Touch screen required" initial="false" desc="Set to true to enable the touch screen support" type="boolean" />
        <Property id="TOUCH_CALIB_WIDTH" name="Maximum width reported by touch function" type="int" min="1" max="65535" initial="240"
                  desc="The maximum width that would be reported when calling the TFT_eSPI touch functions" whenProperty="TFT_TOUCH_SCREEN_REQUIRED" isValue="true"/>
        <Property id="TOUCH_CALIB_HEIGHT" name="Maximum height reported by touch function" type="int" min="1" max="65535" initial="320"
                  desc="The maximum height that would be reported when calling the TFT_eSPI touch functions" whenProperty="TFT_TOUCH_SCREEN_REQUIRED" isValue="true"/>
        <Property id="TOUCH_USE_RAW_TFT_FUNCTION" name="Use the raw TFT function" initial="true" type="boolean"
                  desc="Use the raw function call to acquire the uncalibrated value from TFTeSPI library"
                  whenProperty="TFT_TOUCH_SCREEN_REQUIRED" isValue="true" />

        <Property id="ORIENTATION_SEPARATOR" name="Touch Orientation (DEV test)" initial="" desc="Optional Calibration Settings" type="separator"/>
        <Property id="TFT_TOUCH_SWAP_XY" name="Switch orientation from X,Y to Y,X" initial="false" whenProperty="TFT_TOUCH_SCREEN_REQUIRED" isValue="true"
                  desc="Swaps over the orientation of the touch screen from X,Y to Y,X if needed" type="boolean" />
        <Property id="TFT_TOUCH_X_INVERTED" name="Invert values in raw X dimension" initial="false"  whenProperty="TFT_TOUCH_SCREEN_REQUIRED" isValue="true"
                  type="boolean" desc="Invert the raw X plane on the touch screen (before applying orientation)"/>
        <Property id="TFT_TOUCH_Y_INVERTED" name="Invert values in raw Y dimension" initial="false"  whenProperty="TFT_TOUCH_SCREEN_REQUIRED" isValue="true"
                  type="boolean" desc="Invert the raw Y plane on the touch screen (before applying orientation)"/>


        <Property id="CALIB_SEPARATOR" name="Optional Touch Calibration (DEV test)" initial="" desc="Optional Calibration Settings" type="separator"/>
        <Property id="TFT_TOUCH_SCREEN_CALIBRATE" name="Enable IoAbstraction touch calibration" initial="true"
                  desc="Enable the IoAbstraction internal touch calibration, includes calibration UI" type="boolean" whenProperty="TFT_TOUCH_SCREEN_REQUIRED" isValue="true"  />
        <Property id="TFT_TOUCH_CALIBRATION_STORAGE_LOC" name="Calibration EEPROM storage location" initial="400" type="int"
                  desc="The location in EEPROM to start storing calibration data"  min="4" max="65535" whenProperty="TFT_TOUCH_SCREEN_REQUIRED" isValue="true" />

    </Properties>

    <ApplicabilityDefs>
        <ApplicabilityDef key="touchCalibrationNeeded" mode="and">
            <Applicability whenProperty="TFT_TOUCH_SCREEN_REQUIRED" isValue="true"/>
            <Applicability whenProperty="TFT_TOUCH_SCREEN_CALIBRATE" isValue="true"/>
        </ApplicabilityDef>
    </ApplicabilityDefs>

    <SourceFiles>
        <Replacement find="define TC_TFT_ESPI_NEEDS_TOUCH (true|false)" replace="define TC_TFT_ESPI_NEEDS_TOUCH ${TFT_TOUCH_SCREEN_REQUIRED}"/>
        <SourceFile name="tfteSpi/tcMenuTfteSpi.cpp"/>
        <SourceFile name="tfteSpi/tcMenuTfteSpi.h"/>
    </SourceFiles>

    <IncludeFiles>
        <Header name="tcMenuTfteSpi.h" inSource="true"/>
        <Header name="graphics/MenuTouchScreenEncoder.h" inSource="false" whenProperty="TFT_TOUCH_SCREEN_REQUIRED" isValue="true"/>
        <Header name="extras/DrawableTouchCalibrator.h" inSource="false" applicabilityRef="touchCalibrationNeeded"/>
    </IncludeFiles>

    <GlobalVariables>
        <Variable name="${DISPLAY_VARIABLE}" type="TFT_eSPI" export="true" />

        <Variable name="${DISPLAY_VARIABLE}Drawable" type="TfteSpiDrawable" export="true">
            <Param ref="${DISPLAY_VARIABLE}"/>
            <Param value="${DOUBLE_BUFFER_ROWS}"/>
        </Variable>

        <Variable name="renderer" type="GraphicsDeviceRenderer" export="true">
            <Param value="30"/>
            <Param value="applicationInfo.name"/>
            <Param ref="${DISPLAY_VARIABLE}Drawable"/>
        </Variable>

        <Variable name="touchInterrogator" type="iotouch::TftSpiTouchInterrogator" export="true" whenProperty="TFT_TOUCH_SCREEN_REQUIRED" isValue="true">
            <Param ref="${DISPLAY_VARIABLE}"/>
            <Param value="${TOUCH_CALIB_WIDTH}"/>
            <Param value="${TOUCH_CALIB_HEIGHT}"/>
            <Param value="${TOUCH_USE_RAW_TFT_FUNCTION}"/>
        </Variable>

        <Variable name="touchOrientation" type="iotouch::TouchOrientationSettings" export="false" whenProperty="TFT_TOUCH_SCREEN_REQUIRED" isValue="true">
            <Param value="${TFT_TOUCH_SWAP_XY}"/>
            <Param value="${TFT_TOUCH_X_INVERTED}"/>
            <Param value="${TFT_TOUCH_Y_INVERTED}"/>
        </Variable>

        <Variable name="touchScreen" type="MenuTouchScreenManager" export="true" whenProperty="TFT_TOUCH_SCREEN_REQUIRED" isValue="true">
            <Param ref="touchInterrogator"/>
            <Param ref="renderer"/>
            <Param value="touchOrientation"/>
        </Variable>

        <Variable name="touchCalibrator" type="tcextras::IoaTouchScreenCalibrator" export="true" applicabilityRef="touchCalibrationNeeded">
            <Param ref="touchScreen"/>
            <Param ref="renderer"/>
            <Param value="${TFT_TOUCH_CALIBRATION_STORAGE_LOC}"/>
        </Variable>
    </GlobalVariables>

    <SetupFunctions>
        <Function object="${DISPLAY_VARIABLE}" name="begin"/>

        <Function object="${DISPLAY_VARIABLE}" name="setRotation">
            <Param value="${DISPLAY_ROTATION}"/>
        </Function>

        <Function object="renderer" name="setUpdatesPerSecond">
            <Param value="${UPDATES_PER_SEC}"/>
        </Function>

        <Function name="start" object="touchScreen"  whenProperty="TFT_TOUCH_SCREEN_REQUIRED" isValue="true" />
    </SetupFunctions>
</TcMenuPlugin>