<TcMenuPlugin name="STM32 LTDC frame buffer (optional touch) using BSP functions"
              id="fc7b8f22-6553-43d6-9968-df4ee2562aaf" subsystem="DISPLAY"
              requiresDesigner="2.0" needsTheme="true"
              xmlns="https://www.thecoderscorner.com/libraries/tcmenuPluginItem" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="https://www.thecoderscorner.com/libraries/tcmenuPluginItem https://www.thecoderscorner.com/libraries/tcmenu-plugin-item.xsd">
    <SupportedPlatforms>
        <Platform>MBED_RTOS</Platform>
        <Platform>STM32DUINO</Platform>
    </SupportedPlatforms>
    <Description>Uses the ST Microelectronics BSP driver for the LTDC display buffer, and optionally the BSP touch screen support if needed. This driver is for STM32 boards only when using mbed or Stm32Duino and requires considerable configuration.</Description>
    <Documentation link="https://www.thecoderscorner.com/products/arduino-libraries/tc-menu/tcmenu-plugins/mbed-stm32-menu-touch-display/"/>
    <RequiredLibraries/>
    <ImageFile>adagfx-color.jpg</ImageFile>

    <Properties>
        <Property id="DISPLAY_WIDTH" name="Pixel width in X dimension" initial="240" desc="The number of pixels across the screen" type="int" min="1" max="10000"/>
        <Property id="DISPLAY_HEIGHT" name="Pixel width in Y dimension" initial="320" desc="The number of pixels down the screen" type="int" min="1" max="10000"/>
        <Property id="UPDATES_PER_SEC" name="Screen updates per second" initial="10" desc="How many times per second to check for screen updates" type="int" min="1" max="30" />

        <Property id="TOUCH_SEPARATOR" name="Optional Touch settings" initial="" desc="Optional Settings for BSP touch controller" type="separator"/>
        <Property id="TOUCH_SCREEN_REQUIRED" name="Touch screen required" initial="true" desc="Set to true to enable the touch screen support" type="boolean" />

        <Property id="ORIENTATION_SEPARATOR" name="Touch Orientation" initial="" desc="Optional Calibration Settings" type="separator"/>
        <Property id="TFT_TOUCH_SWAP_XY" name="Switch orientation from X,Y to Y,X" initial="false" whenProperty="TOUCH_SCREEN_REQUIRED" isValue="true"
                  desc="Swaps over the orientation of the touch screen from X,Y to Y,X if needed" type="boolean" />
        <Property id="TFT_TOUCH_X_INVERTED" name="Invert values in raw X dimension" initial="false" whenProperty="TOUCH_SCREEN_REQUIRED" isValue="true"
                  type="boolean" desc="Invert the raw X plane on the touch screen (before applying orientation)"/>
        <Property id="TFT_TOUCH_Y_INVERTED" name="Invert values in raw Y dimension" initial="false" whenProperty="TOUCH_SCREEN_REQUIRED" isValue="true"
                  type="boolean" desc="Invert the raw Y plane on the touch screen (before applying orientation)"/>

        <Property id="CALIB_SEPARATOR" name="Optional Touch Calibration" initial="" desc="Optional Calibration Settings" type="separator"/>
        <Property id="TOUCH_SCREEN_CALIBRATE" name="Enable touch calibration" initial="true"
                  desc="Enable the internal touch calibration, includes calibration UI" type="boolean" whenProperty="TOUCH_SCREEN_REQUIRED" isValue="true"  />
        <Property id="TOUCH_CALIBRATION_STORAGE_LOC" name="Calibration EEPROM storage location" initial="400" type="int"
                  desc="The location in EEPROM to start storing calibration data"  min="4" max="65535" whenProperty="TOUCH_SCREEN_REQUIRED" isValue="true" />
    </Properties>

    <ApplicabilityDefs>
        <ApplicabilityDef key="touchCalibrationNeeded" mode="and">
            <Applicability whenProperty="TOUCH_SCREEN_REQUIRED" isValue="true"/>
            <Applicability whenProperty="TOUCH_SCREEN_CALIBRATE" isValue="true"/>
        </ApplicabilityDef>
    </ApplicabilityDefs>
    <SourceFiles>
        <Replacement find="define TC_BSP_TOUCH_DEVICE_PRESENT true" replace="define TC_BSP_TOUCH_DEVICE_PRESENT ${TOUCH_SCREEN_REQUIRED}"/>
        <SourceFile name="mbedStm32Bsp/BspUserSettings.h" overwrite="never"/>
        <SourceFile name="mbedStm32Bsp/tcMenuStChromaArt.h" />
        <SourceFile name="mbedStm32Bsp/tcMenuStChromaArt.cpp" />
    </SourceFiles>

    <IncludeFiles>
        <Header name="BspUserSettings.h" inSource="true"/>
        <Header name="tcMenuStChromaArt.h" inSource="true"/>
        <Header name="graphics/MenuTouchScreenEncoder.h" inSource="false"/>
        <Header name="extras/DrawableTouchCalibrator.h" inSource="false" applicabilityRef="touchCalibrationNeeded"/>
    </IncludeFiles>

    <GlobalVariables>
        <Variable name="${DISPLAY_VARIABLE}Drawable" type="StChromaArtDrawable" export="true"/>

        <Variable name="renderer" type="GraphicsDeviceRenderer" export="true">
            <Param value="30"/>
            <Param value="applicationInfo.name"/>
            <Param ref="${DISPLAY_VARIABLE}Drawable"/>
        </Variable>

        <Variable name="touchInterrogator" type="StBspTouchInterrogator" export="true" whenProperty="TOUCH_SCREEN_REQUIRED" isValue="true">
            <Param value="${DISPLAY_WIDTH}"/>
            <Param value="${DISPLAY_HEIGHT}"/>
        </Variable>

        <Variable name="touchOrientation" type="iotouch::TouchOrientationSettings" export="false" whenProperty="TOUCH_SCREEN_REQUIRED" isValue="true">
            <Param value="${TFT_TOUCH_SWAP_XY}"/>
            <Param value="${TFT_TOUCH_X_INVERTED}"/>
            <Param value="${TFT_TOUCH_Y_INVERTED}"/>
        </Variable>

        <Variable name="touchScreen" type="MenuTouchScreenManager" export="true" whenProperty="TOUCH_SCREEN_REQUIRED" isValue="true">
            <Param ref="touchInterrogator"/>
            <Param ref="renderer"/>
            <Param value="touchOrientation"/>
        </Variable>

        <Variable name="touchCalibrator" type="tcextras::IoaTouchScreenCalibrator" export="true" applicabilityRef="touchCalibrationNeeded">
            <Param ref="touchScreen"/>
            <Param ref="renderer"/>
            <Param value="${TOUCH_CALIBRATION_STORAGE_LOC}"/>
        </Variable>

    </GlobalVariables>

    <SetupFunctions>
        <Function object="renderer" name="setUpdatesPerSecond">
            <Param value="${UPDATES_PER_SEC}"/>
        </Function>

        <Function name="start" object="touchScreen" whenProperty="TOUCH_SCREEN_REQUIRED" isValue="true"/>
    </SetupFunctions>
</TcMenuPlugin>