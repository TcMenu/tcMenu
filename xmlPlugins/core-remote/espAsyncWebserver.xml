<TcMenuPlugin name="ESP Webserver browser based app" id="da552323-157d-4914-8410-d5b4ff2293a4" subsystem="REMOTE"
              xmlns="https://www.thecoderscorner.com/libraries/tcmenuPluginItem" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="https://www.thecoderscorner.com/libraries/tcmenuPluginItem https://www.thecoderscorner.com/libraries/tcmenu-plugin-item.xsd">
    <SupportedPlatforms>
        <Platform>ARDUINO_ESP8266</Platform>
        <Platform>ARDUINO_ESP32</Platform>
    </SupportedPlatforms>
    <Description>EXPERIMENTAL developer testing - Provides a webserver that can serve up the browser version of embedCONTROL. This works by serving up the react.JS version of embedCONTROL from an onboard webserver, and then this connects to a WebSocket on the device to receive updates and control items.</Description>
    <Documentation link=""/>
    <RequiredLibraries/>
    <ImageFile>embedCONTROLJS.png</ImageFile>

    <Properties>
        <Property id="ASWEB_USE_PREPACKAGED" name="Use the prepackaged app (strongly recommended)" initial="true" type="boolean"
                  desc="Use the prepackaged version of the embed control app static content that's included with this plugin"/>
        <Property id="ASWEB_CONCURRENT" name="Maximum Concurrent Connections" initial="2" type="choice"
                  desc="The maximum number of concurrent client connections to allow before dropping connections">
            <Choices>
                <Choice desc="Only one client">1</Choice>
                <Choice desc="Up to two clients">2</Choice>
                <Choice desc="Up to three clients">3</Choice>
                <Choice desc="Up to four clients">4</Choice>
            </Choices>
        </Property>
        <Property id="WEBSOCKET_ENDPOINT" name="Websocket endpoint (advanced)" initial="/ws" type="text"
                  desc="Websocket endpoint relative address for advanced cases"/>
        <Property id="WEBSERVER_PORT" name="Webserver port (advanced)" initial="80" type="int" min="1" max="32768"
                  desc="The port on which the webserver will listen for advanced cases"/>
    </Properties>

    <ApplicabilityDefs/>

    <SourceFiles>
        <SourceFile name="espAsyncWeb/tcMenuEmbedControlJS.cpp" whenProperty="ASWEB_USE_PREPACKAGED" isValue="true" />
        <SourceFile name="espAsyncWeb/tcMenuEspAsyncWebServer.cpp" />
        <SourceFile name="espAsyncWeb/tcMenuEspAsyncWebServer.h" />
    </SourceFiles>

    <IncludeFiles>
        <Header name="tcMenuEspAsyncWebServer.h" inSource="true"/>
    </IncludeFiles>

    <GlobalVariables>
        <Variable name="webServer" type="EspAsyncWebserver" export="true">
            <Param value="&quot;${WEBSOCKET_ENDPOINT}&quot;" />
            <Param value="${WEBSERVER_PORT}" />
        </Variable>

        <Variable name="webClient1" type="EspWebSocketRemoteConnection">
            <Param value="webServer"/>
        </Variable>
        <Variable name="webClient2" type="EspWebSocketRemoteConnection" whenProperty="ASWEB_CONCURRENT" matches="[23]">
            <Param value="webServer"/>
        </Variable>
        <Variable name="webClient3" type="EspWebSocketRemoteConnection" whenProperty="ASWEB_CONCURRENT" isValue="3">
            <Param value="webServer"/>
        </Variable>
    </GlobalVariables>


    <SetupFunctions>
        <Function name="addConnection" object="remoteServer">
            <Param ref="webClient1"/>
        </Function>
        <Function name="addConnection" object="remoteServer" whenProperty="ASWEB_CONCURRENT" matches="[23]">
            <Param ref="webClient2"/>
        </Function>
        <Function name="addConnection" object="remoteServer" whenProperty="ASWEB_CONCURRENT" isValue="3">
            <Param ref="webClient3"/>
        </Function>
    </SetupFunctions>
</TcMenuPlugin>