<TcMenuPlugin name="Serve EmbedCONTROL.JS using a WebServer" id="da552323-157d-4914-8410-d5b4ff2293a4" subsystem="REMOTE"
              xmlns="https://www.thecoderscorner.com/libraries/tcmenuPluginItem" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="https://www.thecoderscorner.com/libraries/tcmenuPluginItem https://www.thecoderscorner.com/libraries/tcmenu-plugin-item.xsd">
    <SupportedPlatforms>
        <Platform>ARDUINO_UNO</Platform>
        <Platform>ARDUINO_AVR</Platform>
        <Platform>ARDUINO_32</Platform>
        <Platform>ARDUINO_ESP8266</Platform>
        <Platform>ARDUINO_ESP32</Platform>
        <Platform>STM32DUINO</Platform>
    </SupportedPlatforms>
    <Description>BETA - serves up embedCONTROL.JS to a browser using the chosen webserver. The app is served directly, with updates and control over a WebSocket.</Description>
    <Documentation link=""/>
    <RequiredLibraries/>
    <ImageFile>embedCONTROLJS.png</ImageFile>

    <Properties>
        <Property id="ASWEB_USE_PREPACKAGED" name="Use the prepackaged app (strongly recommended)" initial="true" type="boolean"
                  desc="Use the prepackaged version of the embed control app static content that's included with this plugin"/>
        <Property id="ASWEB_CONCURRENT" name="Maximum Concurrent Connections" initial="2" type="choice"
                  desc="The maximum number of concurrent client connections to allow before dropping connections">
            <Choices>
                <Choice desc="Only one client">1</Choice>
                <Choice desc="Up to two clients">2</Choice>
                <Choice desc="Up to three clients">3</Choice>
            </Choices>
        </Property>
        <Property id="ASWEB_SERVER_TO_USE" name="Web Server library to use" initial="ESP_WEB_SERVER" type="choice"
                  desc="Choose a webserver library that is compatible with your board">
            <Choices>
                <Choice desc="Ethernet WebServer Arduino">ARDUINO_ETHERNET_WEBSERVER</Choice>
                <Choice desc="Ethernet WebServer STM32Eth">STM32_ETHERNET_WEBSERVER</Choice>
                <Choice desc="ESP Regular Webserver">ESP_WEB_SERVER</Choice>
                <Choice desc="ESP Async WebServer - DevBETA!!">ESP_ASYNC_WEB_SERVER</Choice>
                <Choice desc="STM32 Async WebServer - DevBETA!!">STM32_ASYNC_WEB_SERVER</Choice>
            </Choices>
        </Property>
        <Property id="WEBSOCKET_ENDPOINT" name="Websocket endpoint (advanced)" initial="/ws" type="text"
                  desc="Websocket endpoint relative address for advanced cases"/>
        <Property id="WEBSERVER_PORT" name="Webserver port (advanced)" initial="80" type="int" min="1" max="32768"
                  desc="The port on which the webserver will listen for advanced cases"/>
        <Property id="WEBSOCK_PORT1" name="Websocket port 1" initial="3333" type="int"
                  desc="First websocket port number"/>
        <Property id="WEBSOCK_PORT1" name="Websocket port 2" initial="3334" type="int"
                  desc="First websocket port number" whenProperty="ASWEB_CONCURRENT" matches="2|3"/>
        <Property id="WEBSOCK_PORT1" name="Websocket port 3" initial="3335" type="int"
                  desc="First websocket port number" whenProperty="ASWEB_CONCURRENT" isValue="3"/>
    </Properties>

    <ApplicabilityDefs/>

    <SourceFiles>
        <Replacement find="define WEBSERVER_LIB .*" replace="define WEBSERVER_LIB ${ASWEB_SERVER_TO_USE}"/>
        <SourceFile name="deviceWebServer/tcMenuEmbedControlJS.cpp"/>
        <SourceFile name="deviceWebServer/tcMenuECWebServer.cpp" />
        <SourceFile name="deviceWebServer/tcMenuECWebServer.h" />
    </SourceFiles>

    <IncludeFiles>
        <Header name="tcMenuECWebServer.h" inSource="true"/>
    </IncludeFiles>

    <GlobalVariables>
        <Variable name="webServer" type="EspAsyncWebserver" export="true">
            <Param value="&quot;${WEBSOCKET_ENDPOINT}&quot;" />
            <Param value="${WEBSERVER_PORT}" />
        </Variable>

        <Variable name="webClient1" type="EspWebSocketRemoteConnection">
            <Param value="webServer"/>
        </Variable>


        <Variable name="webClient2" type="EspWebSocketRemoteConnection" whenProperty="ASWEB_CONCURRENT" matches="[23]">
            <Param value="webServer"/>
        </Variable>
        <Variable name="webClient3" type="EspWebSocketRemoteConnection" whenProperty="ASWEB_CONCURRENT" isValue="3">
            <Param value="webServer"/>
        </Variable>
    </GlobalVariables>


    <SetupFunctions>
        <Function name="addConnection" object="remoteServer">
            <Param ref="webClient1"/>
        </Function>
        <Function name="addConnection" object="remoteServer" whenProperty="ASWEB_CONCURRENT" matches="[23]">
            <Param ref="webClient2"/>
        </Function>
        <Function name="addConnection" object="remoteServer" whenProperty="ASWEB_CONCURRENT" isValue="3">
            <Param ref="webClient3"/>
        </Function>
    </SetupFunctions>
</TcMenuPlugin>