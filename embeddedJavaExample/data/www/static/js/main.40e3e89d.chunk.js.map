{"version":3,"sources":["api/protocol/TagValEnums.ts","img/large_icon.webp","api/MenuItem.ts","api/protocol/MenuCommands.ts","api/protocol/TagValProtocol.ts","api/MenuTree.ts","api/MenuController.ts","api/MenuItemFormatter.ts","img/pairing.webp","PairingPanel.tsx","MenuUI.tsx","api/remote/WebSocketConnector.ts","GlobalSettings.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["TVMenuFields","HeartbeatMode","BootstrapMode","ChangeType","ButtonType","DialogMode","ApiPlatform","AckStatus","MenuCommandType","JOIN","PAIRING_REQUEST","HEARTBEAT","BOOTSTRAP","ANALOG_BOOT_ITEM","ACTION_BOOT_ITEM","SUBMENU_BOOT_ITEM","ENUM_BOOT_ITEM","BOOLEAN_BOOT_ITEM","TEXT_BOOT_ITEM","RUNTIME_LIST_BOOT","BOOT_SCROLL_CHOICE","BOOT_RGB_COLOR","LARGE_NUM_BOOT_ITEM","FLOAT_BOOT_ITEM","REMOTE_BOOT_ITEM","ACKNOWLEDGEMENT","CHANGE_INT_FIELD","DIALOG_UPDATE","BooleanNaming","MenuItem","initialValue","messageType","itemName","menuId","readOnly","visible","changed","currentValue","this","markChanged","newName","newId","newVal","AnalogMenuItem","id","maxValue","divisor","offset","unitName","setMenuId","maxVal","newDivisor","newOffs","EnumMenuItem","itemList","newList","ListMenuItem","numberOfItems","items","TextEditMode","BooleanMenuItem","naming","TRUE_FALSE","FloatMenuItem","decimalPlaces","decPlaces","ActionMenuItem","SubMenuItem","name","children","setItemName","setReadOnly","setVisible","clearChanged","item","push","EditableLargeNumberMenuItem","digitsAllowed","negativeAllowed","allowed","places","neg","Rgb32MenuItem","alphaChannelOn","on","ScrollChoice","pos","text","currentPos","val","data","split","length","parseInt","ScrollChoiceMenuItem","numberOfEntries","entries","EditableTextMenuItem","editMode","PLAIN_TEXT","textLength","len","mode","MenuCommand","commandType","_commandType","HeartbeatCommand","frequency","hbMode","_frequency","_mode","BootstrapCommand","bootstrapMode","_bootstrapMode","AcknowledgmentCommand","status","correlation","_status","_correlation","DialogUpdateCommand","header","buffer","button1","button2","_header","_buffer","_button1","_button2","JoinCommand","uuid","platform","version","_name","_uuid","_platform","_version","ItemChangeCommand","value","_menuId","_value","PairingCommand","appName","appUuid","_appName","_appUuid","MenuItemUpdateCommand","parId","_item","_parentId","OutgoingMenuCommandHandler","expectedMsgType","msgHandler","cmd","TcProtocolError","message","Error","stack","UNEXPECTED_EOM","KEY_NOT_DEF","MSG_TOO_SMALL","TagValProtocolParser","keyToValueMap","parseData","position","dataToParse","foundEnd","charCodeAt","key","readString","ch","charAt","ret","getValue","def","TagValProtocolHandler","tree","parsedKeyVal","incomingTagValMsgProcessors","outgoingTagValMsgProcessors","initialiseProtocol","msgKey","handler","parser","getValueAsIntWithDefault","HB_FREQUENCY_FIELD","getValueAsInt","HB_MODE_FIELD","KEY_BOOT_TYPE_FIELD","START","STOP","KEY_ACK_STATUS","KEY_CORRELATION_FIELD","KEY_MODE_FIELD","SHOW","HIDE","ACTION","getValueWithDefault","KEY_HEADER_FIELD","KEY_BUFFER_FIELD","KEY_BUTTON1_FIELD","KEY_BUTTON2_FIELD","KEY_NAME_FIELD","KEY_UUID_FIELD","KEY_PLATFORM_ID","parseFloat","KEY_VER_FIELD","p","ty","KEY_CHANGE_TYPE","currentVal","ABSOLUTE_LIST","listItemHasUpdated","KEY_NO_OF_CHOICES","KEY_CURRENT_VAL","KEY_ID_FIELD","incomingChangeMessage","processSubMenuItem","processAnalogItem","processBooleanItem","processActionItem","processRgbItem","processFloatItem","processEnumItem","processLargeNumItem","processListItem","processScrollChoiceItem","processTextItem","buildHeartbeat","buildJoin","buildPairing","buildDialogAction","buildUpdate","tagValStr","msgType","substr","restOfMsg","startParseData","processor","menuCommand","applyMsg","mt","String","fromCharCode","joinCmd","startMessage","asTagVal","toString","pairingCmd","changeCmd","chg","toFixed","l","i","character","KEY_PREPEND_NAMECHOICE","KEY_PREPEND_CHOICE","dlgCmd","hb","createMenuItemFn","subId","KEY_PARENT_ID_FIELD","myId","getMenuItemFor","addMenuItem","KEY_VISIBLE_FIELD","KEY_READONLY_FIELD","processMenuItem","setAlphaChannelOn","KEY_ALPHA_FIELD","rgb","setCurrentValue","setOffset","KEY_ANALOG_OFFSET_FIELD","setDivisor","KEY_ANALOG_DIVISOR_FIELD","setMaxValue","KEY_ANALOG_MAX_FIELD","setUnitName","KEY_ANALOG_UNIT_FIELD","setNaming","KEY_BOOLEAN_NAMING","current","setDecimalPlaces","KEY_FLOAT_DECIMAL_PLACES","setNumberOfEntries","fromString","setTextLength","KEY_MAX_LENGTH","setEditMode","KEY_EDIT_TYPE","setNegativeAllowed","KEY_NEGATIVE_ALLOWED","setDigitsAllowed","enumItems","noOfItems","setItemList","list","Array","ControllerState","MenuTree","treeStructChangeFn","allItemMap","rootElement","treeStructureChanged","subMenuId","menuItem","getMenuId","sub","addChildItem","clearAll","staticCorCount","makeCorrelation","Math","floor","random","niceState","currentState","CONNECTED","READY","FAILED_AUTHENTICATION","PAIRED_OK","STOPPED","NOT_CONNECTED","MenuController","connector","appInfo","menuTree","protocolHandler","componentsById","lastHeartbeatRx","lastHeartbeatTx","hbFrequency","currentConnection","appVersion","appPlatform","JS_API","dialogListener","stateListener","undefined","pairingMode","customMessageHandler","rebuildTree","Date","now","m","console","warn","getName","state","isRunning","registerMessageHandler","proto","msg","messageProcessor","setCurrentState","registerConnectionListener","connected","why","sendMessage","convertCommandToWire","getAppName","getAppUuid","rawVersion","process","regex","match","parseAppVersion","emptyTree","checkHeartbeats","tickAllElements","start","cb","stop","startTime","delay","closeConnection","isConnected","dt","Object","values","forEach","comp","tick","setTimeout","bind","error","NORMAL","lastDisconnectTime","ARDUINO","ARDUINO_32","JAVA_API","DNET_API","nicePlatform","cleanComponents","info","rootId","getRoot","rootComponent","structureHasChanged","itemId","getCurrentValue","ABSOLUTE","e","row","doubleClick","listResponse","LIST_SELECTION","amt","button","sp","asString","DELTA","possibleMsg","convertWireToCommand","joinReceived","itemHasUpdated","heartbeatReceived","pairingRequest","dialogHasUpdated","bootstrapEvent","acknowledgement","log","pair","dlg","join","evt","gotStart","debug","ack","ackReceived","SUCCESS","rawMessage","cleanMsg","charNum","toPrintableMessage","customHandler","listener","ms","Promise","resolve","formatStringToWire","num","round","getDivisor","getOffset","getMaxValue","getItemList","isTrue","flt","isNegativeAllowed","getDecimalPlaces","et","getEditMode","getTextLength","IP_ADDRESS","TIME_24H","TIME_24_HUNDREDS","TIME_12H","GREGORIAN_DATE","formatEditableTextWire","formatForDisplay","an","calcVal","whole","fractMax","getActualDecimalDivisor","fraction","abs","padStart","calculateRequiredDigits","getUnitName","formatAnalogItem","curr","getNaming","YES_NO","ON_OFF","formatBooleanItem","PairingMode","MenuUIState","PairingPanel","props","buttonText","NOT_STARTED","pairingButtonClicked","a","controller","attemptPairing","update","setState","STARTED","DONE","window","location","reload","src","pairingImg","className","alt","onClick","Component","CurrentSocketState","BaseMenuUI","lastUpdate","itemState","outstandingCorrelation","bindAllControls","updateItem","getTree","putMenuComponent","RECENT_UPDATE","internalUpdateItem","correlationId","ackStatus","UPDATE_ERROR","forceUpdate","timeNow","ticks","PENDING_UPDATE","baseClass","getMenuName","getItemName","isReadOnly","SubMenuUI","renderableChildren","isExpanded","getChildren","toggleExpand","listItems","filter","it","isVisible","map","RootSubMenuUI","registerStateListener","UpDownEditorUI","sendDecrease","sendIncrease","sendDeltaUpdate","markRecentlyUpdated","calculatedClass","disabled","TextBasedMenuUI","editingMode","rollbackValue","startEditing","cancelPressed","submitPressed","textHasChanged","sendAbsoluteUpdate","alert","event","currentTarget","type","onChange","ListItemRowUI","sendListResponseUpdate","detail","ListMenuItemUI","rowNum","ActionableTextMenuItem","buttonPressed","extraTxt","sendActionableUpdate","Rgb32ColorEditor","editingStarted","editingRequested","colorHasChanged","colStyle","backgroundColor","style","WebSocketConnector","url","connectionListener","messageHandler","socket","DISCONNECTED","lastDisconnect","currentData","CONNECTING","WebSocket","onclose","reason","code","onopen","ev","onmessage","possibleMessage","getPossibleMessage","protocol","msgStart","retVal","substring","close","readyState","OPEN","send","GlobalAppSettings","SETTINGS_APP_NAME","SETTINGS_APP_UUID","SETTINGS_WEBSOCKET_EXT","uuidv4","webSocketExtension","doesCookieExist","getCookieOrDefault","setCookie","wsExtension","GlobalSettingsPanel","appNameHasChanged","appUuidHasChanged","webSocketHasChanged","formSubmitPrevention","settings","setAppName","setAppUuid","setWebSocketExtension","preventDefault","onSubmit","htmlFor","getWebSocketExtension","expires","setTime","getTime","document","cookie","toUTCString","nameLenPlus","c","trim","decodeURIComponent","App","settingsActive","settingsButtonWasPressed","hasStartedYet","customUrl","globalSettings","globalSocket","host","globalController","err","st","logo","DialogItemUI","registerDialogListener","shown","title","content","btn1","btn2","button1Clicked","button2Clicked","btn","ACCEPT","CANCEL","OK","CLOSE","sendDialogAction","dialogClasses","textFromBtnType","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.40e3e89d.chunk.js","sourcesContent":["export enum TVMenuFields {\r\n    KEY_NAME_FIELD = \"NM\",\r\n    KEY_UUID_FIELD = \"UU\",\r\n    KEY_VER_FIELD = \"VE\",\r\n    HB_FREQUENCY_FIELD = \"HI\",\r\n    HB_MODE_FIELD = \"HR\",\r\n    KEY_PLATFORM_ID = \"PF\",\r\n    KEY_BOOT_TYPE_FIELD = \"BT\",\r\n    KEY_ID_FIELD = \"ID\",\r\n    KEY_CORRELATION_FIELD = \"IC\",\r\n    KEY_EEPROM_FIELD = \"IE\",\r\n    KEY_READONLY_FIELD = \"RO\",\r\n    KEY_VISIBLE_FIELD = \"VI\",\r\n    KEY_ALPHA_FIELD = \"RA\",\r\n    KEY_WIDTH_FIELD = \"WI\",\r\n    KEY_PARENT_ID_FIELD = \"PI\",\r\n    KEY_ANALOG_MAX_FIELD = \"AM\",\r\n    KEY_ANALOG_OFFSET_FIELD = \"AO\",\r\n    KEY_ANALOG_DIVISOR_FIELD = \"AD\",\r\n    KEY_ANALOG_UNIT_FIELD = \"AU\",\r\n    KEY_FLOAT_DECIMAL_PLACES = \"FD\",\r\n    KEY_NEGATIVE_ALLOWED = \"NA\",\r\n    KEY_REMOTE_NUM = \"RN\",\r\n    KEY_CURRENT_VAL = \"VC\",\r\n    KEY_BOOLEAN_NAMING = \"BN\",\r\n    KEY_NO_OF_CHOICES = \"NC\",\r\n    KEY_MAX_LENGTH = \"ML\",\r\n    KEY_EDIT_TYPE = \"EM\",\r\n    KEY_PREPEND_CHOICE = \"C\", // second char from A onwards.\r\n    KEY_PREPEND_NAMECHOICE = \"c\", // second char from A onwards.\r\n    KEY_CHANGE_TYPE = \"TC\",\r\n    KEY_ACK_STATUS = \"ST\",\r\n    KEY_MODE_FIELD = \"MO\",\r\n    KEY_BUFFER_FIELD = \"BU\",\r\n    KEY_HEADER_FIELD = \"HF\",\r\n    KEY_BUTTON1_FIELD = \"B1\",\r\n    KEY_BUTTON2_FIELD = \"B2\"\r\n}\r\n\r\nexport class MenuCommandType {\r\n    public static JOIN = \"NJ\";\r\n    public static PAIRING_REQUEST = \"PR\";\r\n    public static HEARTBEAT = \"HB\";\r\n    public static BOOTSTRAP = \"BS\";\r\n    public static ANALOG_BOOT_ITEM = \"BA\";\r\n    public static ACTION_BOOT_ITEM = \"BC\";\r\n    public static SUBMENU_BOOT_ITEM = \"BM\";\r\n    public static ENUM_BOOT_ITEM = \"BE\";\r\n    public static BOOLEAN_BOOT_ITEM = \"BB\";\r\n    public static TEXT_BOOT_ITEM = \"BT\";\r\n    public static RUNTIME_LIST_BOOT = \"BL\";\r\n    public static BOOT_SCROLL_CHOICE = \"BZ\";\r\n    public static BOOT_RGB_COLOR = \"BK\";\r\n    public static LARGE_NUM_BOOT_ITEM = \"BN\";\r\n    public static FLOAT_BOOT_ITEM = \"BF\";\r\n    public static REMOTE_BOOT_ITEM = \"BR\";\r\n    public static ACKNOWLEDGEMENT = \"AK\";\r\n    public static CHANGE_INT_FIELD = \"VC\";\r\n    public static DIALOG_UPDATE = \"DM\"\r\n}\r\n\r\nexport enum HeartbeatMode {\r\n    NORMAL, START, END\r\n}\r\n\r\nexport enum BootstrapMode {\r\n    START, STOP\r\n}\r\n\r\nexport enum ChangeType {\r\n    DELTA = 0, ABSOLUTE = 1, ABSOLUTE_LIST = 2, LIST_SELECTION = 3\r\n}\r\n\r\nexport enum ButtonType {\r\n    OK, ACCEPT, CANCEL, CLOSE, NONE\r\n}\r\n\r\nexport enum DialogMode {\r\n    SHOW= 'S', HIDE = 'H', ACTION = 'A'\r\n}\r\n\r\nexport enum ApiPlatform {\r\n    ARDUINO = 0, ARDUINO_32 = 2, JAVA_API = 1, DNET_API = 3,JS_API = 4\r\n}\r\n\r\nexport enum AckStatus {\r\n    VALUE_OUT_OF_RANGE = -1, SUCCESS = 0, ID_NOT_FOUND = 1, INVALID_CREDENTIALS = 2, UNSPECIFIED_ERROR = 10000\r\n}\r\n\r\nexport function isAckStatusError(ack: AckStatus) {\r\n    return ack > 0;\r\n}\r\n","export default __webpack_public_path__ + \"static/media/large_icon.5be57cbe.webp\";","export class MenuItem<V> {\r\n    messageType: string = 'Undefined';\r\n    private itemName: string = \"\";\r\n    private menuId: string = \"\";\r\n    private readOnly: boolean = false;\r\n    private visible: boolean = false;\r\n    private changed: boolean = false;\r\n    private currentValue: V;\r\n\r\n    constructor(initialValue: V) {\r\n        this.currentValue = initialValue;\r\n    }\r\n\r\n    public isReadOnly(): boolean {\r\n        return this.readOnly;\r\n    }\r\n\r\n    public setReadOnly(readOnly: boolean) {\r\n        this.readOnly = readOnly;\r\n        this.markChanged();\r\n    }\r\n\r\n    public isVisible(): boolean {\r\n        return this.visible;\r\n    }\r\n\r\n    public setVisible(visible: boolean) {\r\n        this.visible = visible;\r\n        this.markChanged();\r\n    }\r\n\r\n    public getItemName(): string {\r\n        return this.itemName;\r\n    }\r\n\r\n    public setItemName(newName: string) {\r\n        this.itemName = newName;\r\n        this.markChanged();\r\n    }\r\n\r\n    public getMenuId(): string {\r\n        return this.menuId;\r\n    }\r\n\r\n    public setMenuId(newId: string) {\r\n        this.menuId = newId;\r\n        this.markChanged();\r\n    }\r\n\r\n    public markChanged() {\r\n        this.changed = true;\r\n    }\r\n\r\n    public clearChanged() {\r\n        this.changed = false;\r\n    }\r\n\r\n    public isChanged(): boolean {\r\n        return this.changed;\r\n    }\r\n\r\n    public getCurrentValue(): V {\r\n        return this.currentValue;\r\n    }\r\n\r\n    public setCurrentValue(newVal: V) {\r\n        this.currentValue = newVal;\r\n        this.markChanged();\r\n    }\r\n}\r\n\r\nexport class AnalogMenuItem extends MenuItem<number> {\r\n    messageType: string = 'Analog';\r\n    private maxValue: number = 0;\r\n    private divisor: number = 0;\r\n    private offset: number = 0;\r\n    private unitName: string = \"\";\r\n\r\n    public constructor(id: string) {\r\n        super(0);\r\n        this.setMenuId(id);\r\n    }\r\n\r\n    public getMaxValue(): number {\r\n        return this.maxValue;\r\n    }\r\n\r\n    public setMaxValue(maxVal: number) {\r\n        this.maxValue = maxVal;\r\n        this.markChanged();\r\n    }\r\n\r\n    public getDivisor(): number {\r\n        return this.divisor;\r\n    }\r\n\r\n    public setDivisor(newDivisor: number) {\r\n        this.divisor = newDivisor;\r\n        this.markChanged();\r\n    }\r\n\r\n    public getOffset(): number {\r\n        return this.offset;\r\n    }\r\n\r\n    public setOffset(newOffs: number) {\r\n        this.offset = newOffs;\r\n        this.markChanged();\r\n    }\r\n\r\n    public getUnitName(): string {\r\n        return this.unitName;\r\n    }\r\n\r\n    public setUnitName(unitName: string) {\r\n        this.unitName = unitName;\r\n        this.markChanged();\r\n    }\r\n}\r\n\r\nexport class EnumMenuItem extends MenuItem<number> {\r\n    messageType: string = 'Enum';\r\n    private itemList: Array<string> = [];\r\n\r\n    public constructor(id: string) {\r\n        super(0);\r\n        this.setMenuId(id);\r\n    }\r\n\r\n    public getItemList(): Array<string> {\r\n        return this.itemList;\r\n    }\r\n\r\n    public setItemList(newList: Array<string>) {\r\n        this.itemList = newList;\r\n        this.markChanged();\r\n    }\r\n}\r\nexport class ListMenuItem extends MenuItem<Array<string>> {\r\n    messageType: string = 'List'\r\n    numberOfItems: number = 0;\r\n\r\n    public constructor(id: string) {\r\n        super([]);\r\n        this.setMenuId(id);\r\n    }\r\n\r\n    setNumberOfItems(items: number): void {\r\n        this.numberOfItems = items;\r\n        this.markChanged();\r\n    }\r\n\r\n    getNumberOfItems(): number {\r\n        return this.numberOfItems;\r\n    }\r\n}\r\n\r\nexport enum BooleanNaming { TRUE_FALSE, ON_OFF, YES_NO}\r\n\r\nexport class BooleanMenuItem extends MenuItem<boolean> {\r\n    messageType: string = 'Boolean';\r\n    private naming: BooleanNaming = BooleanNaming.TRUE_FALSE;\r\n\r\n    public constructor(id: string) {\r\n        super(false);\r\n        this.setMenuId(id);\r\n    }\r\n\r\n    public getNaming(): BooleanNaming {\r\n        return this.naming;\r\n    }\r\n\r\n    public setNaming(naming: BooleanNaming) {\r\n        this.naming = naming;\r\n        this.markChanged();\r\n    }\r\n}\r\n\r\nexport class FloatMenuItem extends MenuItem<number> {\r\n    messageType: string = 'Float';\r\n    private decimalPlaces: number = 1;\r\n\r\n    public constructor(id: string) {\r\n        super(0.0);\r\n        this.setMenuId(id);\r\n    }\r\n\r\n    public getDecimalPlaces(): number {\r\n        return this.decimalPlaces;\r\n    }\r\n\r\n    public setDecimalPlaces(decPlaces: number) {\r\n        this.decimalPlaces = decPlaces;\r\n        this.markChanged();\r\n    }\r\n}\r\n\r\nexport class ActionMenuItem extends MenuItem<boolean> {\r\n    messageType: string = \"Action\";\r\n\r\n    public constructor(id: string) {\r\n        super(false);\r\n        this.setMenuId(id);\r\n    }\r\n}\r\n\r\nexport class SubMenuItem extends MenuItem<boolean> {\r\n    messageType: string = 'Sub';\r\n    private children: Array<MenuItem<any>> = [];\r\n\r\n    public constructor(name: string, id: string) {\r\n        super(false);\r\n        this.setItemName(name);\r\n        this.setMenuId(id);\r\n        this.setReadOnly(false);\r\n        this.setVisible(true);\r\n        this.clearChanged();\r\n    }\r\n\r\n\r\n    public getChildren(): Array<MenuItem<any>> {\r\n        return this.children;\r\n    }\r\n\r\n    public addChildItem(item: MenuItem<any>) {\r\n        this.children.push(item);\r\n        this.markChanged();\r\n    }\r\n\r\n    clearAll() {\r\n        this.children = [];\r\n        this.markChanged();\r\n    }\r\n}\r\n\r\nexport class EditableLargeNumberMenuItem extends MenuItem<number> {\r\n    public messageType: string = \"LargeNum\";\r\n    private digitsAllowed: number = 8;\r\n    private decimalPlaces: number = 3;\r\n    private negativeAllowed: boolean = false;\r\n\r\n    constructor(id: string) {\r\n        super(0.0);\r\n        this.setMenuId(id);\r\n    }\r\n\r\n    getDigitsAllowed(): number {\r\n        return this.digitsAllowed;\r\n    }\r\n\r\n    setDigitsAllowed(allowed: number): void {\r\n        this.digitsAllowed = allowed;\r\n        this.markChanged();\r\n    }\r\n\r\n    getDecimalPlaces(): number {\r\n        return this.decimalPlaces;\r\n    }\r\n\r\n    setDecimalPlaces(places: number): void {\r\n        this.decimalPlaces = places;\r\n        this.markChanged();\r\n    }\r\n\r\n    isNegativeAllowed(): boolean {\r\n        return this.negativeAllowed;\r\n    }\r\n\r\n    setNegativeAllowed(neg: boolean): void {\r\n        this.negativeAllowed = neg;\r\n        this.markChanged();\r\n    }\r\n}\r\n\r\nexport class Rgb32MenuItem extends MenuItem<string> {\r\n    public messageType: string = \"Rgb32\";\r\n    private alphaChannelOn: boolean = false;\r\n\r\n    constructor(id: string) {\r\n        super(\"#ffffff\");\r\n        this.setMenuId(id);\r\n    }\r\n\r\n    isAlphaChannelOn(): boolean {\r\n        return this.alphaChannelOn;\r\n    }\r\n\r\n    setAlphaChannelOn(on: boolean) {\r\n        this.alphaChannelOn = on;\r\n        this.markChanged();\r\n    }\r\n}\r\n\r\nexport class ScrollChoice {\r\n    public currentPos: number = 0;\r\n    public currentValue: string = \"\";\r\n\r\n    constructor(pos: number, text: string) {\r\n        this.currentPos = pos;\r\n        this.currentValue = text;\r\n    }\r\n\r\n    static fromString(val: string): ScrollChoice {\r\n        let data = val?.split(\":\");\r\n        if(data?.length === 2) {\r\n            return new ScrollChoice(parseInt(data[0]), data[1]);\r\n        } else {\r\n            return new ScrollChoice(0, \"\");\r\n        }\r\n    }\r\n\r\n    asString(): string {\r\n        return this.currentPos + \"-\" + this.currentValue;\r\n    }\r\n}\r\n\r\nexport class ScrollChoiceMenuItem extends MenuItem<ScrollChoice> {\r\n    public messageType: string = \"Scroll\";\r\n    private numberOfEntries: number = 0;\r\n\r\n    constructor(id: string) {\r\n        super(new ScrollChoice(0, \"\"));\r\n        this.setMenuId(id);\r\n    }\r\n\r\n    setNumberOfEntries(entries: number) {\r\n        this.numberOfEntries = entries;\r\n        this.markChanged();\r\n    }\r\n\r\n    getNumberOfEntries(): number {\r\n        return this.numberOfEntries;\r\n    }\r\n}\r\n\r\nexport enum TextEditMode {\r\n    PLAIN_TEXT, IP_ADDRESS, TIME_24H, TIME_12H, TIME_24_HUNDREDS, GREGORIAN_DATE,\r\n    TIME_DURATION_SECONDS, TIME_DURATION_HUNDREDS, TIME_24H_HHMM, TIME_12H_HHMM\r\n}\r\n\r\nexport class EditableTextMenuItem extends MenuItem<string> {\r\n    public messageType: string = \"Text\";\r\n    private editMode: TextEditMode = TextEditMode.PLAIN_TEXT;\r\n    private textLength: number = 10;\r\n\r\n    constructor(id: string) {\r\n        super(\"\");\r\n        this.setMenuId(id);\r\n    }\r\n\r\n    getTextLength(): number {\r\n        return this.textLength;\r\n    }\r\n\r\n    setTextLength(len: number): void {\r\n        this.textLength = len;\r\n        this.markChanged();\r\n    }\r\n\r\n    getEditMode(): TextEditMode {\r\n        return this.editMode;\r\n    }\r\n\r\n    setEditMode(mode: TextEditMode): void {\r\n        this.editMode = mode;\r\n        this.markChanged();\r\n    }\r\n}","import {\r\n    AckStatus, ApiPlatform,\r\n    BootstrapMode,\r\n    ButtonType,\r\n    ChangeType,\r\n    DialogMode,\r\n    HeartbeatMode,\r\n    MenuCommandType\r\n} from \"./TagValEnums\";\r\nimport {MenuItem} from \"../MenuItem\";\r\n\r\nexport class MenuCommand {\r\n    private readonly _commandType: string;\r\n\r\n    constructor(commandType: string) {\r\n        this._commandType = commandType;\r\n    }\r\n\r\n    get commandType(): string {\r\n        return this._commandType;\r\n    }\r\n}\r\n\r\nexport class HeartbeatCommand extends MenuCommand {\r\n    private readonly _frequency: number;\r\n    private readonly _mode: HeartbeatMode;\r\n\r\n    constructor(frequency: number, hbMode: HeartbeatMode) {\r\n        super(MenuCommandType.HEARTBEAT);\r\n        this._frequency = frequency;\r\n        this._mode = hbMode;\r\n    }\r\n\r\n    get frequency(): number {\r\n        return this._frequency;\r\n    }\r\n\r\n    get mode(): HeartbeatMode {\r\n        return this._mode;\r\n    }\r\n}\r\n\r\nexport class BootstrapCommand extends MenuCommand {\r\n    private readonly _bootstrapMode: BootstrapMode;\r\n\r\n    constructor(bootstrapMode: BootstrapMode) {\r\n        super(MenuCommandType.BOOTSTRAP);\r\n        this._bootstrapMode = bootstrapMode;\r\n    }\r\n\r\n    get bootstrapMode(): BootstrapMode {\r\n        return this._bootstrapMode;\r\n    }\r\n}\r\n\r\nexport class AcknowledgmentCommand extends MenuCommand {\r\n    private readonly _status: AckStatus;\r\n    private readonly _correlation: string;\r\n\r\n    constructor(status: AckStatus, correlation: string) {\r\n        super(MenuCommandType.ACKNOWLEDGEMENT);\r\n        this._status = status;\r\n        this._correlation = correlation;\r\n    }\r\n\r\n    get status(): AckStatus {\r\n        return this._status;\r\n    }\r\n\r\n    get correlation(): string {\r\n        return this._correlation;\r\n    }\r\n}\r\n\r\nexport class DialogUpdateCommand extends MenuCommand {\r\n    private readonly _mode: DialogMode;\r\n    private readonly _header: string;\r\n    private readonly _buffer: string;\r\n    private readonly _button1: ButtonType;\r\n    private readonly _button2: ButtonType;\r\n    private _correlation: string;\r\n\r\n    constructor(mode: DialogMode, header: string, buffer: string, button1: ButtonType, button2: ButtonType, correlation: string) {\r\n        super(MenuCommandType.DIALOG_UPDATE);\r\n        this._mode = mode;\r\n        this._header = header;\r\n        this._buffer = buffer;\r\n        this._button1 = button1;\r\n        this._button2 = button2;\r\n        this._correlation = correlation;\r\n    }\r\n\r\n    get mode(): DialogMode {\r\n        return this._mode;\r\n    }\r\n\r\n    get correlation(): string {\r\n        return this._correlation;\r\n    }\r\n\r\n    get header(): string {\r\n        return this._header;\r\n    }\r\n\r\n    get buffer(): string {\r\n        return this._buffer;\r\n    }\r\n\r\n    get button1(): ButtonType {\r\n        return this._button1;\r\n    }\r\n\r\n    get button2(): ButtonType {\r\n        return this._button2;\r\n    }\r\n}\r\n\r\nexport class JoinCommand extends MenuCommand {\r\n    private readonly _name: string;\r\n    private readonly _uuid: string;\r\n    private readonly _platform: ApiPlatform;\r\n    private readonly _version: number;\r\n\r\n    constructor(name: string, uuid: string, platform: ApiPlatform, version: number) {\r\n        super(MenuCommandType.JOIN);\r\n        this._name = name;\r\n        this._uuid = uuid;\r\n        this._platform = platform;\r\n        this._version = version;\r\n    }\r\n\r\n    get name(): string {\r\n        return this._name;\r\n    }\r\n\r\n    get uuid(): string {\r\n        return this._uuid;\r\n    }\r\n\r\n    get platform(): ApiPlatform {\r\n        return this._platform;\r\n    }\r\n\r\n    get version(): number {\r\n        return this._version;\r\n    }\r\n}\r\n\r\nexport class ItemChangeCommand extends MenuCommand {\r\n    private readonly _menuId: string;\r\n    private readonly _mode: ChangeType;\r\n    private readonly _value: string|string[]\r\n    private readonly _correlation: string\r\n\r\n    constructor(menuId: string, mode: ChangeType, value: string | string[], correlation: string) {\r\n        super(MenuCommandType.CHANGE_INT_FIELD);\r\n        this._menuId = menuId;\r\n        this._mode = mode;\r\n        this._value = value;\r\n        this._correlation = correlation;\r\n    }\r\n\r\n    get menuId(): string {\r\n        return this._menuId;\r\n    }\r\n\r\n    get mode(): ChangeType {\r\n        return this._mode;\r\n    }\r\n\r\n    get value(): string | string[] {\r\n        return this._value;\r\n    }\r\n\r\n    get correlation(): string {\r\n        return this._correlation;\r\n    }\r\n}\r\n\r\nexport class PairingCommand extends MenuCommand {\r\n    private readonly _appName: string;\r\n    private readonly _appUuid: string;\r\n\r\n\r\n    constructor(appName: string, appUuid: string) {\r\n        super(MenuCommandType.PAIRING_REQUEST);\r\n        this._appName = appName;\r\n        this._appUuid = appUuid;\r\n    }\r\n\r\n    get appName(): string {\r\n        return this._appName;\r\n    }\r\n\r\n    get appUuid(): string {\r\n        return this._appUuid;\r\n    }\r\n}\r\n\r\nexport class MenuItemUpdateCommand<T> extends MenuCommand {\r\n    private readonly _item: MenuItem<T>;\r\n    private readonly _parentId: string;\r\n    private readonly _value: T;\r\n\r\n    constructor(commandType: string, item: MenuItem<T>, parId: string, value: T) {\r\n        super(commandType);\r\n        this._item = item;\r\n        this._parentId = parId;\r\n        this._value = value;\r\n    }\r\n\r\n\r\n    get item(): MenuItem<T> {\r\n        return this._item;\r\n    }\r\n\r\n    get parentId(): string {\r\n        return this._parentId;\r\n    }\r\n\r\n    get value(): T {\r\n        return this._value;\r\n    }\r\n}\r\n","import {\r\n    ActionMenuItem,\r\n    AnalogMenuItem,\r\n    BooleanMenuItem,\r\n    EditableLargeNumberMenuItem,\r\n    EditableTextMenuItem,\r\n    EnumMenuItem,\r\n    FloatMenuItem,\r\n    ListMenuItem,\r\n    MenuItem,\r\n    Rgb32MenuItem,\r\n    ScrollChoice,\r\n    ScrollChoiceMenuItem,\r\n    SubMenuItem\r\n} from \"../MenuItem\";\r\nimport {BootstrapMode, ChangeType, DialogMode, MenuCommandType, TVMenuFields} from \"./TagValEnums\";\r\nimport {\r\n    AcknowledgmentCommand,\r\n    BootstrapCommand,\r\n    DialogUpdateCommand,\r\n    HeartbeatCommand,\r\n    ItemChangeCommand,\r\n    JoinCommand,\r\n    MenuCommand,\r\n    MenuItemUpdateCommand,\r\n    PairingCommand\r\n} from \"./MenuCommands\";\r\nimport {MenuTree} from \"../MenuTree\";\r\n\r\nexport const PROTOCOL_TAG_VAL = 0x01;\r\nexport const TAG_START_OF_MSG = 0x01;\r\nexport const TAG_END_OF_MSG = 0x02;\r\nconst TAG_FIELD_TERMINATOR = '|';\r\n\r\ntype MenuCtorFunction<V extends MenuItem<any>> = (parser: TagValProtocolParser, id: string) => V;\r\n\r\nclass OutgoingMenuCommandHandler<T extends MenuCommand> {\r\n    private readonly expectedMsgType: string;\r\n    private readonly msgHandler: (cmd: T) => string;\r\n\r\n    constructor(expectedMsgType: string, msgHandler: (cmd: T) => string) {\r\n        this.expectedMsgType = expectedMsgType;\r\n        this.msgHandler = msgHandler;\r\n    }\r\n\r\n    applyMsg(cmd: MenuCommand): string {\r\n        if(cmd.commandType === this.expectedMsgType) {\r\n            return this.msgHandler(cmd as T);\r\n        } else {\r\n            throw new TcProtocolError(\"Unexpected message type \" + cmd.commandType + \" when expecting \" + this.expectedMsgType);\r\n        }\r\n    }\r\n}\r\n\r\nexport interface TcProtocolHandler {\r\n    addIncomingTagValHandler(msgKey: string, handler: (parser: TagValProtocolParser) => MenuCommand): void;\r\n    addOutgoingTagValHandler(msgKey: string, handler: OutgoingMenuCommandHandler<any>): void;\r\n    convertWireToCommand(tagValStr: string): MenuCommand | undefined;\r\n    convertCommandToWire(menuCommand: MenuCommand): string;\r\n\r\n}\r\n\r\nexport class TcProtocolError extends Error {\r\n    public static UNEXPECTED_EOM: string = \"Unexpected End Of Message\";\r\n    public static KEY_NOT_DEF: string = \"Key not defined: \";\r\n    public static MSG_TOO_SMALL: string = \"Message too small: \";\r\n\r\n    constructor(public message: string) {\r\n        super(message);\r\n        this.name = \"TcProtocolError\";\r\n        ({stack: this.stack} = (new Error() as any));\r\n    }\r\n\r\n}\r\n\r\nexport class TagValProtocolParser {\r\n    private keyToValueMap: { [id:string]: string } = {};\r\n    private parseData: string = \"\";\r\n    private position: number = 0;\r\n\r\n    public startParseData(dataToParse: string) {\r\n        this.position = 0;\r\n        this.keyToValueMap = {};\r\n        this.parseData = dataToParse;\r\n        let foundEnd = false;\r\n        while (this.position < this.parseData.length && !foundEnd) {\r\n            if (this.parseData.charCodeAt(this.position) === TAG_END_OF_MSG) {\r\n                break;\r\n            }\r\n\r\n            let key = this.readString();\r\n            if (!key) {\r\n                throw new TcProtocolError(TcProtocolError.UNEXPECTED_EOM);\r\n            } else {\r\n                let val = this.readString();\r\n                if (!val && val.charCodeAt(0) === TAG_END_OF_MSG) {\r\n                    foundEnd = true;\r\n                }\r\n                this.keyToValueMap[key] = val;\r\n            }\r\n        }\r\n    }\r\n\r\n    readString(): string {\r\n        let value = \"\";\r\n        while (this.position < this.parseData.length) {\r\n            let ch = this.parseData.charAt(this.position++);\r\n            if (ch === '\\\\') {\r\n                // special escape case allows anything to be sent\r\n                ch = this.parseData.charAt(this.position++);\r\n                value += ch;\r\n            } else if (ch === '=' || ch === TAG_FIELD_TERMINATOR) {\r\n                // end of current token\r\n                return value;\r\n            } else {\r\n                // within current token\r\n                value += ch;\r\n            }\r\n        }\r\n        return value;\r\n    }\r\n\r\n    getValue(key: string): string {\r\n        const ret = this.keyToValueMap[key];\r\n        if (!ret) throw new TcProtocolError(TcProtocolError.KEY_NOT_DEF + key);\r\n        return ret;\r\n    }\r\n\r\n    getValueAsInt(key: string): number {\r\n        return parseInt(this.getValue(key));\r\n    }\r\n\r\n    getValueWithDefault(key: string, def: string): string {\r\n        const ret = this.keyToValueMap[key];\r\n        return ret ?? def;\r\n    }\r\n\r\n    getValueAsIntWithDefault(key: string, def: number): number {\r\n        const ret = this.keyToValueMap[key];\r\n        return (ret) ? parseInt(ret) : def;\r\n    }\r\n}\r\n\r\nexport class TagValProtocolHandler implements TcProtocolHandler {\r\n    private readonly parsedKeyVal: TagValProtocolParser;\r\n    private readonly tree: MenuTree;\r\n    private readonly incomingTagValMsgProcessors: {[key: string]: (parser: TagValProtocolParser) => MenuCommand} = {}\r\n    private readonly outgoingTagValMsgProcessors: {[key: string]: OutgoingMenuCommandHandler<any>} = {}\r\n\r\n    public constructor(tree: MenuTree) {\r\n        this.parsedKeyVal = new TagValProtocolParser();\r\n        this.tree = tree;\r\n        this.initialiseProtocol();\r\n    }\r\n\r\n    public addIncomingTagValHandler(msgKey: string, handler: (parser: TagValProtocolParser) => MenuCommand): void {\r\n        this.incomingTagValMsgProcessors[msgKey] = handler;\r\n    }\r\n\r\n    public addOutgoingTagValHandler(msgKey: string, handler: OutgoingMenuCommandHandler<any>): void {\r\n        this.outgoingTagValMsgProcessors[msgKey] = handler;\r\n    }\r\n\r\n    private initialiseProtocol() {\r\n        this.incomingTagValMsgProcessors[MenuCommandType.HEARTBEAT] = (parser) => new HeartbeatCommand(\r\n                    parser.getValueAsIntWithDefault(TVMenuFields.HB_FREQUENCY_FIELD, 1500),\r\n                    parser.getValueAsInt(TVMenuFields.HB_MODE_FIELD)\r\n        );\r\n\r\n        this.incomingTagValMsgProcessors[MenuCommandType.BOOTSTRAP] = (parser) => new BootstrapCommand(\r\n            parser.getValue(TVMenuFields.KEY_BOOT_TYPE_FIELD) === \"START\" ? BootstrapMode.START : BootstrapMode.STOP);\r\n        this.incomingTagValMsgProcessors[MenuCommandType.ACKNOWLEDGEMENT] = (parser) => new AcknowledgmentCommand(\r\n                    parser.getValueAsInt(TVMenuFields.KEY_ACK_STATUS),\r\n                    parser.getValue(TVMenuFields.KEY_CORRELATION_FIELD)\r\n        );\r\n\r\n        this.incomingTagValMsgProcessors[MenuCommandType.DIALOG_UPDATE] = parser => new DialogUpdateCommand(\r\n                    fromTextToDlgMode(parser.getValue(TVMenuFields.KEY_MODE_FIELD)),\r\n                    parser.getValueWithDefault(TVMenuFields.KEY_HEADER_FIELD, \"\"),\r\n                    parser.getValueWithDefault(TVMenuFields.KEY_BUFFER_FIELD, \"\"),\r\n                    parser.getValueAsIntWithDefault(TVMenuFields.KEY_BUTTON1_FIELD, 0),\r\n                    parser.getValueAsIntWithDefault(TVMenuFields.KEY_BUTTON2_FIELD, 0),\r\n                    parser.getValueWithDefault(TVMenuFields.KEY_CORRELATION_FIELD, \"0\")\r\n        );\r\n        this.incomingTagValMsgProcessors[MenuCommandType.JOIN] = parser => new JoinCommand(\r\n                    parser.getValue(TVMenuFields.KEY_NAME_FIELD),\r\n                    parser.getValue(TVMenuFields.KEY_UUID_FIELD),\r\n                    parser.getValueAsIntWithDefault(TVMenuFields.KEY_PLATFORM_ID, 0),\r\n                    parseFloat(parser.getValue(TVMenuFields.KEY_VER_FIELD)) / 100.0\r\n        );\r\n\r\n        this.incomingTagValMsgProcessors[MenuCommandType.CHANGE_INT_FIELD] = parser => incomingChangeMessage(parser);\r\n\r\n        this.incomingTagValMsgProcessors[MenuCommandType.PAIRING_REQUEST] = parser => new PairingCommand(\r\n            parser.getValue(TVMenuFields.KEY_NAME_FIELD),\r\n            parser.getValue(TVMenuFields.KEY_UUID_FIELD)\r\n        );\r\n\r\n        this.incomingTagValMsgProcessors[MenuCommandType.SUBMENU_BOOT_ITEM] = parser => this.processSubMenuItem(parser);\r\n        this.incomingTagValMsgProcessors[MenuCommandType.ANALOG_BOOT_ITEM] = parser => this.processAnalogItem(parser);\r\n        this.incomingTagValMsgProcessors[MenuCommandType.BOOLEAN_BOOT_ITEM] = parser => this.processBooleanItem(parser);\r\n        this.incomingTagValMsgProcessors[MenuCommandType.ACTION_BOOT_ITEM] = parser => this.processActionItem(parser);\r\n        this.incomingTagValMsgProcessors[MenuCommandType.BOOT_RGB_COLOR] = parser => this.processRgbItem(parser);\r\n        this.incomingTagValMsgProcessors[MenuCommandType.FLOAT_BOOT_ITEM] = parser => this.processFloatItem(parser);\r\n        this.incomingTagValMsgProcessors[MenuCommandType.ENUM_BOOT_ITEM] = parser => this.processEnumItem(parser);\r\n        this.incomingTagValMsgProcessors[MenuCommandType.LARGE_NUM_BOOT_ITEM] = parser => this.processLargeNumItem(parser);\r\n        this.incomingTagValMsgProcessors[MenuCommandType.RUNTIME_LIST_BOOT] = parser => this.processListItem(parser);\r\n        this.incomingTagValMsgProcessors[MenuCommandType.BOOT_SCROLL_CHOICE] = parser => this.processScrollChoiceItem(parser);\r\n        this.incomingTagValMsgProcessors[MenuCommandType.TEXT_BOOT_ITEM] = parser => this.processTextItem(parser);\r\n\r\n        this.outgoingTagValMsgProcessors[MenuCommandType.HEARTBEAT] = new OutgoingMenuCommandHandler<HeartbeatCommand>(MenuCommandType.HEARTBEAT,\r\n            (cmd) => this.buildHeartbeat(cmd));\r\n        this.outgoingTagValMsgProcessors[MenuCommandType.JOIN] = new OutgoingMenuCommandHandler<JoinCommand>(MenuCommandType.JOIN,\r\n            (cmd) => this.buildJoin(cmd));\r\n        this.outgoingTagValMsgProcessors[MenuCommandType.PAIRING_REQUEST] = new OutgoingMenuCommandHandler<PairingCommand>(MenuCommandType.PAIRING_REQUEST,\r\n            (cmd) => this.buildPairing(cmd));\r\n        this.outgoingTagValMsgProcessors[MenuCommandType.DIALOG_UPDATE] = new OutgoingMenuCommandHandler<DialogUpdateCommand>(MenuCommandType.HEARTBEAT,\r\n            (cmd) => this.buildDialogAction(cmd));\r\n        this.outgoingTagValMsgProcessors[MenuCommandType.CHANGE_INT_FIELD] = new OutgoingMenuCommandHandler<ItemChangeCommand>(MenuCommandType.CHANGE_INT_FIELD,\r\n            (cmd) => this.buildUpdate(cmd));\r\n    }\r\n\r\n\r\n    public convertWireToCommand(tagValStr: string): MenuCommand | undefined {\r\n        if (tagValStr.length < 3) throw new TcProtocolError(TcProtocolError.MSG_TOO_SMALL + tagValStr);\r\n        let msgType = tagValStr.substr(0, 2);\r\n        let restOfMsg = tagValStr.substr(2);\r\n        let parser = this.parsedKeyVal;\r\n        parser.startParseData(restOfMsg);\r\n        let processor = this.incomingTagValMsgProcessors[msgType];\r\n        if(!processor) return undefined;\r\n        return processor(parser);\r\n    }\r\n\r\n    public convertCommandToWire(menuCommand: MenuCommand): string {\r\n        if(!menuCommand) throw new TcProtocolError(\"Unexpected null message\");\r\n        const processor = this.outgoingTagValMsgProcessors[menuCommand.commandType];\r\n        return processor?.applyMsg(menuCommand);\r\n    }\r\n\r\n    asTagVal(key: string, val: string): string {\r\n        return key + \"=\" + val + TAG_FIELD_TERMINATOR;\r\n    }\r\n\r\n    startMessage(mt: string) {\r\n        return String.fromCharCode(TAG_START_OF_MSG) + String.fromCharCode(PROTOCOL_TAG_VAL) + mt;\r\n    }\r\n\r\n    buildJoin(joinCmd: JoinCommand) {\r\n        return this.startMessage(MenuCommandType.JOIN) +\r\n            this.asTagVal(TVMenuFields.KEY_NAME_FIELD, joinCmd.name) +\r\n            this.asTagVal(TVMenuFields.KEY_UUID_FIELD, joinCmd.uuid) +\r\n            this.asTagVal(TVMenuFields.KEY_VER_FIELD, String(joinCmd.version)) +\r\n            this.asTagVal(TVMenuFields.KEY_PLATFORM_ID, joinCmd.platform.toString(10)) +\r\n            String.fromCharCode(TAG_END_OF_MSG);\r\n    }\r\n\r\n    buildPairing(pairingCmd: PairingCommand) {\r\n        return this.startMessage(MenuCommandType.PAIRING_REQUEST) +\r\n            this.asTagVal(TVMenuFields.KEY_NAME_FIELD, pairingCmd.appName) +\r\n            this.asTagVal(TVMenuFields.KEY_UUID_FIELD, pairingCmd.appUuid) +\r\n            String.fromCharCode(TAG_END_OF_MSG);\r\n\r\n    }\r\n\r\n    buildUpdate(changeCmd: ItemChangeCommand) {\r\n        let chg = this.startMessage(MenuCommandType.CHANGE_INT_FIELD) +\r\n            this.asTagVal(TVMenuFields.KEY_CHANGE_TYPE, changeCmd.mode.toFixed(0)) +\r\n            this.asTagVal(TVMenuFields.KEY_ID_FIELD, changeCmd.menuId) +\r\n            this.asTagVal(TVMenuFields.KEY_CORRELATION_FIELD, changeCmd.correlation);\r\n            if(changeCmd.mode === ChangeType.ABSOLUTE_LIST) {\r\n                let l = changeCmd.value as Array<string>;\r\n                this.asTagVal(TVMenuFields.KEY_NO_OF_CHOICES, l.length.toString(10));\r\n                for(let i=0; i<l.length; i++) {\r\n                    let character = String.fromCharCode(65 + i)\r\n                    chg += this.asTagVal(TVMenuFields.KEY_PREPEND_NAMECHOICE + character, \"\");\r\n                    chg += this.asTagVal(TVMenuFields.KEY_PREPEND_CHOICE + character, l[i]);\r\n                }\r\n            } else {\r\n                chg += this.asTagVal(TVMenuFields.KEY_CURRENT_VAL, changeCmd.value.toString());\r\n            }\r\n            chg += String.fromCharCode(TAG_END_OF_MSG);\r\n            return chg;\r\n    }\r\n\r\n    buildDialogAction(dlgCmd: DialogUpdateCommand) {\r\n        return this.startMessage(MenuCommandType.DIALOG_UPDATE) +\r\n            this.asTagVal(TVMenuFields.KEY_MODE_FIELD, dlgCmd.mode) +\r\n            this.asTagVal(TVMenuFields.KEY_HEADER_FIELD, dlgCmd.header) +\r\n            this.asTagVal(TVMenuFields.KEY_BUFFER_FIELD, dlgCmd.buffer) +\r\n            this.asTagVal(TVMenuFields.KEY_BUTTON1_FIELD, dlgCmd.button1.toFixed(0)) +\r\n            this.asTagVal(TVMenuFields.KEY_BUTTON2_FIELD, dlgCmd.button2.toFixed(0)) +\r\n            String.fromCharCode(TAG_END_OF_MSG);\r\n    }\r\n\r\n    buildHeartbeat(hb: HeartbeatCommand) {\r\n        return this.startMessage(MenuCommandType.HEARTBEAT) +\r\n            this.asTagVal(TVMenuFields.HB_MODE_FIELD, hb.mode.toString(10)) +\r\n            this.asTagVal(TVMenuFields.HB_FREQUENCY_FIELD, hb.frequency.toString(10)) +\r\n            String.fromCharCode(TAG_END_OF_MSG);\r\n    }\r\n\r\n    private processMenuItem<V extends MenuItem<any>>(createMenuItemFn: MenuCtorFunction<V>): V {\r\n        let parser = this.parsedKeyVal;\r\n        let subId = parser.getValue(TVMenuFields.KEY_PARENT_ID_FIELD);\r\n        let myId = parser.getValue(TVMenuFields.KEY_ID_FIELD);\r\n        let item = this.tree.getMenuItemFor(myId) as V;\r\n        if(!item) {\r\n            item = createMenuItemFn(parser, myId);\r\n            this.tree.addMenuItem(subId, item);\r\n        }\r\n        item.setVisible(parser.getValueAsInt(TVMenuFields.KEY_VISIBLE_FIELD) !== 0);\r\n        item.setReadOnly(parser.getValueAsInt(TVMenuFields.KEY_READONLY_FIELD) !== 0);\r\n        item.setItemName(parser.getValue(TVMenuFields.KEY_NAME_FIELD))\r\n        return item;\r\n    }\r\n\r\n    private processSubMenuItem(parser: TagValProtocolParser): MenuCommand {\r\n        let item = this.processMenuItem((parser, id) => new SubMenuItem(parser.getValue(TVMenuFields.KEY_NAME_FIELD), id));\r\n        return new MenuItemUpdateCommand(MenuCommandType.SUBMENU_BOOT_ITEM, item, parser.getValue(TVMenuFields.KEY_PARENT_ID_FIELD), false)\r\n    }\r\n\r\n    private processActionItem(parser: TagValProtocolParser): MenuCommand {\r\n        let item = this.processMenuItem((parser, id) => new ActionMenuItem(id));\r\n        return new MenuItemUpdateCommand(MenuCommandType.ACTION_BOOT_ITEM, item, parser.getValue(TVMenuFields.KEY_PARENT_ID_FIELD), false)\r\n    }\r\n\r\n    private processRgbItem(parser: TagValProtocolParser): MenuCommand {\r\n        let item = this.processMenuItem((parser, id) => new Rgb32MenuItem(id));\r\n        item.setAlphaChannelOn(parser.getValueAsInt(TVMenuFields.KEY_ALPHA_FIELD)!==0);\r\n        const rgb = parser.getValueWithDefault(TVMenuFields.KEY_CURRENT_VAL, \"#ffffff\");\r\n        item.setCurrentValue(rgb);\r\n        return new MenuItemUpdateCommand(MenuCommandType.BOOT_RGB_COLOR, item, parser.getValue(TVMenuFields.KEY_PARENT_ID_FIELD), rgb)\r\n    }\r\n\r\n    private processAnalogItem(parser: TagValProtocolParser): MenuCommand {\r\n        let item: AnalogMenuItem = this.processMenuItem<AnalogMenuItem>((parser, id) => new AnalogMenuItem(id));\r\n        item.setOffset(parser.getValueAsInt(TVMenuFields.KEY_ANALOG_OFFSET_FIELD));\r\n        item.setDivisor(parser.getValueAsInt(TVMenuFields.KEY_ANALOG_DIVISOR_FIELD));\r\n        item.setMaxValue(parser.getValueAsInt(TVMenuFields.KEY_ANALOG_MAX_FIELD));\r\n        item.setUnitName(parser.getValueWithDefault(TVMenuFields.KEY_ANALOG_UNIT_FIELD, \"\"));\r\n        const currentVal = parseInt(parser.getValue(TVMenuFields.KEY_CURRENT_VAL));\r\n        item.setCurrentValue(currentVal);\r\n        return new MenuItemUpdateCommand(MenuCommandType.ANALOG_BOOT_ITEM, item, parser.getValue(TVMenuFields.KEY_PARENT_ID_FIELD), currentVal);\r\n    }\r\n\r\n    private processBooleanItem(parser: TagValProtocolParser): MenuCommand {\r\n        let item: BooleanMenuItem = this.processMenuItem<BooleanMenuItem>((parser, id) => new BooleanMenuItem(id));\r\n        item.setNaming(parser.getValueAsInt(TVMenuFields.KEY_BOOLEAN_NAMING));\r\n        const current = parser.getValue(TVMenuFields.KEY_CURRENT_VAL) === '1';\r\n        item.setCurrentValue(current);\r\n        return new MenuItemUpdateCommand(MenuCommandType.BOOLEAN_BOOT_ITEM, item, parser.getValue(TVMenuFields.KEY_PARENT_ID_FIELD), current);\r\n    }\r\n\r\n    private processFloatItem(parser: TagValProtocolParser): MenuCommand {\r\n        let item: FloatMenuItem = this.processMenuItem<FloatMenuItem>((parser, id) => new FloatMenuItem(id));\r\n        item.setDecimalPlaces(parser.getValueAsInt(TVMenuFields.KEY_FLOAT_DECIMAL_PLACES));\r\n        const current = (parseFloat(parser.getValue(TVMenuFields.KEY_CURRENT_VAL)));\r\n        item.setCurrentValue(current);\r\n        return new MenuItemUpdateCommand(MenuCommandType.FLOAT_BOOT_ITEM, item, parser.getValue(TVMenuFields.KEY_PARENT_ID_FIELD), current);\r\n    }\r\n\r\n    private processScrollChoiceItem(parser: TagValProtocolParser): MenuCommand {\r\n        let item: ScrollChoiceMenuItem = this.processMenuItem<ScrollChoiceMenuItem>((parser, id) => new ScrollChoiceMenuItem(id));\r\n        item.setNumberOfEntries(parser.getValueAsInt(TVMenuFields.KEY_NO_OF_CHOICES));\r\n        const current = (ScrollChoice.fromString(TVMenuFields.KEY_CURRENT_VAL));\r\n        item.setCurrentValue(current);\r\n        return new MenuItemUpdateCommand(MenuCommandType.BOOT_SCROLL_CHOICE, item, parser.getValue(TVMenuFields.KEY_PARENT_ID_FIELD), current);\r\n    }\r\n\r\n    private processTextItem(parser: TagValProtocolParser): MenuCommand {\r\n        let item = this.processMenuItem<EditableTextMenuItem>((parser, id) => new EditableTextMenuItem(id));\r\n        item.setTextLength(parser.getValueAsInt(TVMenuFields.KEY_MAX_LENGTH));\r\n        item.setEditMode(parser.getValueAsInt(TVMenuFields.KEY_EDIT_TYPE));\r\n        const current = (parser.getValueWithDefault(TVMenuFields.KEY_CURRENT_VAL, \"\"));\r\n        item.setCurrentValue(current);\r\n        return new MenuItemUpdateCommand(MenuCommandType.TEXT_BOOT_ITEM, item, parser.getValue(TVMenuFields.KEY_PARENT_ID_FIELD), current);\r\n    }\r\n\r\n    private processLargeNumItem(parser: TagValProtocolParser): MenuCommand {\r\n        let item = this.processMenuItem<EditableLargeNumberMenuItem>((parser, id) => new EditableLargeNumberMenuItem(id));\r\n        item.setDecimalPlaces(parser.getValueAsInt(TVMenuFields.KEY_FLOAT_DECIMAL_PLACES));\r\n        item.setNegativeAllowed(parser.getValueAsInt(TVMenuFields.KEY_NEGATIVE_ALLOWED) > 0);\r\n        item.setDigitsAllowed(parser.getValueAsInt(TVMenuFields.KEY_MAX_LENGTH));\r\n        const current = (parseFloat(parser.getValueWithDefault(TVMenuFields.KEY_CURRENT_VAL, \"0\")));\r\n        item.setCurrentValue(current);\r\n        return new MenuItemUpdateCommand(MenuCommandType.LARGE_NUM_BOOT_ITEM, item, parser.getValue(TVMenuFields.KEY_PARENT_ID_FIELD), current);\r\n    }\r\n\r\n    private processListItem(parser: TagValProtocolParser): MenuCommand {\r\n        const item = this.processMenuItem<ListMenuItem>((parser, id) => new ListMenuItem(id));\r\n        const num = parser.getValueAsIntWithDefault(TVMenuFields.KEY_NO_OF_CHOICES, 0);\r\n        const items = listItemHasUpdated(num, parser);\r\n        item.setCurrentValue(items);\r\n        return new MenuItemUpdateCommand(MenuCommandType.RUNTIME_LIST_BOOT, item, parser.getValue(TVMenuFields.KEY_PARENT_ID_FIELD), items);\r\n    }\r\n\r\n    private processEnumItem(parser: TagValProtocolParser): MenuCommand {\r\n        let item: EnumMenuItem = this.processMenuItem<EnumMenuItem>((parser, id) => new EnumMenuItem(id));\r\n\r\n        let enumItems = [];\r\n        let noOfItems = parser.getValueAsInt(TVMenuFields.KEY_NO_OF_CHOICES);\r\n        for(let i=0; i<noOfItems; i++) {\r\n            enumItems.push(parser.getValueWithDefault(\"C\" + String.fromCharCode(65 + i), \"\"));\r\n        }\r\n\r\n        item.setItemList(enumItems);\r\n        const current = (parseInt(parser.getValue(TVMenuFields.KEY_CURRENT_VAL)));\r\n        item.setCurrentValue(current);\r\n\r\n        return new MenuItemUpdateCommand(MenuCommandType.ENUM_BOOT_ITEM, item, parser.getValue(TVMenuFields.KEY_PARENT_ID_FIELD), current);\r\n    }\r\n}\r\n\r\nexport function toPrintableMessage(rawMessage: string): string {\r\n    let cleanMsg = \"\";\r\n    for(let i=0; i<rawMessage.length; i++) {\r\n        let charNum = rawMessage.charCodeAt(i);\r\n        if(charNum<31) {\r\n            cleanMsg += \"<\" + charNum + \">\";\r\n        }\r\n        else {\r\n            cleanMsg += rawMessage.charAt(i);\r\n        }\r\n    }\r\n    return cleanMsg;\r\n}\r\n\r\nfunction incomingChangeMessage(p: TagValProtocolParser) {\r\n    const ty = p.getValueAsInt(TVMenuFields.KEY_CHANGE_TYPE);\r\n    const correlation = p.getValueWithDefault(\"\", TVMenuFields.KEY_CORRELATION_FIELD);\r\n    let currentVal = \"\";\r\n    if(ty === ChangeType.ABSOLUTE_LIST) {\r\n        const items = p.getValueAsIntWithDefault(TVMenuFields.KEY_NO_OF_CHOICES, 0);\r\n        listItemHasUpdated(items, p);\r\n    } else {\r\n        currentVal = p.getValueWithDefault(TVMenuFields.KEY_CURRENT_VAL, \"\");\r\n    }\r\n\r\n    return new ItemChangeCommand(p.getValue(TVMenuFields.KEY_ID_FIELD), ty, currentVal, correlation);\r\n}\r\n\r\nfunction listItemHasUpdated(items: number, parser: TagValProtocolParser): Array<string> {\r\n    let list = Array<string>();\r\n    for(let i=0; i<items; i++) {\r\n        let character = String.fromCharCode(65 + i);\r\n        const name = parser.getValueWithDefault(TVMenuFields.KEY_PREPEND_NAMECHOICE + character, \"\");\r\n        const value = parser.getValueWithDefault(TVMenuFields.KEY_PREPEND_CHOICE + character, \"\");\r\n        list.push(name + \" \" + value);\r\n    }\r\n    return list;\r\n}\r\n\r\nfunction fromTextToDlgMode(value: string): DialogMode {\r\n    return value==='S' ? DialogMode.SHOW : value === 'H' ? DialogMode.HIDE : DialogMode.ACTION;\r\n}\r\n","import {MenuItem, SubMenuItem} from \"./MenuItem\";\r\n\r\ntype TreeStructureChangedFn = (menuTree: MenuTree, id: string) => void;\r\n\r\nexport class MenuTree {\r\n    private allItemMap: { [id: string]: MenuItem<any>; } = {};\r\n    private readonly rootElement = new SubMenuItem(\"ROOT\", \"0\");\r\n    private treeStructureChanged: TreeStructureChangedFn;\r\n\r\n    constructor(treeStructChangeFn: TreeStructureChangedFn) {\r\n        this.allItemMap[\"0\"] = this.rootElement;\r\n        this.treeStructureChanged = treeStructChangeFn;\r\n    }\r\n\r\n    public getRoot() {\r\n        return this.rootElement;\r\n    }\r\n\r\n    public getMenuItemFor(key: string): MenuItem<any> {\r\n        return this.allItemMap[key];\r\n    }\r\n\r\n    public addMenuItem(subMenuId: string, menuItem: MenuItem<any>): boolean {\r\n        if(!this.getMenuItemFor(menuItem.getMenuId())) {\r\n            let sub = this.allItemMap[subMenuId] as SubMenuItem;\r\n            if (!sub) sub = this.rootElement;\r\n            sub.addChildItem(menuItem);\r\n            this.allItemMap[menuItem.getMenuId()] = menuItem;\r\n            this.treeStructureChanged(this, menuItem.getMenuId());\r\n            return true;\r\n        }\r\n        else return false; // already existed so not re-added.\r\n    }\r\n\r\n    emptyTree() {\r\n        this.allItemMap = {};\r\n        this.rootElement.clearAll();\r\n        this.allItemMap[\"0\"] = this.rootElement;\r\n        this.treeStructureChanged(this, this.rootElement.getMenuId());\r\n    }\r\n}","import {\r\n    AckStatus,\r\n    ApiPlatform,\r\n    BootstrapMode,\r\n    ButtonType,\r\n    ChangeType,\r\n    DialogMode,\r\n    HeartbeatMode,\r\n    MenuCommandType\r\n} from \"./protocol/TagValEnums\";\r\nimport {TagValProtocolHandler, TcProtocolHandler, toPrintableMessage} from \"./protocol/TagValProtocol\";\r\nimport {MenuTree} from \"./MenuTree\";\r\nimport {AnalogMenuItem, BooleanMenuItem, EnumMenuItem, ScrollChoice, ScrollChoiceMenuItem} from \"./MenuItem\";\r\nimport {\r\n    AcknowledgmentCommand,\r\n    BootstrapCommand,\r\n    DialogUpdateCommand,\r\n    HeartbeatCommand,\r\n    ItemChangeCommand,\r\n    JoinCommand,\r\n    MenuCommand,\r\n    PairingCommand\r\n} from \"./protocol/MenuCommands\";\r\n\r\nexport type APIMessageHandler = (protocol: number, rawMessage: string) => void;\r\nexport type APIConnectionListener = (connected: boolean, text: string) => void;\r\nexport type DialogUpdateCallback = (shown: boolean, title: string, content: string, btn1: ButtonType, btn2: ButtonType) => void;\r\nexport type PairingCallback = (update: string) => void;\r\n\r\nexport interface APIConnector {\r\n    start(): void;\r\n    stop(): void;\r\n    closeConnection(): void;\r\n    sendMessage(rawMessage: string): void;\r\n    registerMessageHandler(messageHandler: APIMessageHandler): void;\r\n    registerConnectionListener(connectionListener: APIConnectionListener): void;\r\n    isConnected(): boolean;\r\n    getName(): string;\r\n    lastDisconnectTime(): number;\r\n}\r\n\r\nexport interface MenuComponent {\r\n    structureHasChanged(): void;\r\n    itemHasUpdated(): void;\r\n    tick(timeNow: number): void;\r\n    ackReceived(correlationId: number, ackStatus: AckStatus): void;\r\n}\r\n\r\nexport interface AppInfo {\r\n    getAppName(): string;\r\n    getAppUuid(): string;\r\n}\r\n\r\nlet staticCorCount = 0;\r\nfunction makeCorrelation(): number {\r\n    return Math.floor((Math.random() * 0xfffff) + (++staticCorCount));\r\n}\r\n\r\nexport enum ControllerState {\r\n    STOPPED,\r\n    NOT_CONNECTED,\r\n    CONNECTED,\r\n    BOOTSTRAP,\r\n    READY,\r\n    FAILED_AUTHENTICATION,\r\n    PAIRED_OK\r\n}\r\n\r\nfunction niceState(currentState: ControllerState) {\r\n    switch (currentState) {\r\n        case ControllerState.CONNECTED: return \"Connected\";\r\n        case ControllerState.BOOTSTRAP: return \"Receiving Items\";\r\n        case ControllerState.READY: return \"Ready\";\r\n        case ControllerState.FAILED_AUTHENTICATION: return \"Not Authorized\";\r\n        case ControllerState.PAIRED_OK: return \"Paired\";\r\n        case ControllerState.STOPPED:\r\n        case ControllerState.NOT_CONNECTED: return \"Not Connected\";\r\n    }\r\n}\r\n\r\nfunction nicePlatform(platform: ApiPlatform) {\r\n    switch (platform) {\r\n        case ApiPlatform.ARDUINO:\r\n        case ApiPlatform.ARDUINO_32: return \"Arduino\";\r\n        case ApiPlatform.JAVA_API: return \"Java/PI\";\r\n        case ApiPlatform.DNET_API: return \".NET\";\r\n        case ApiPlatform.JS_API: return \"JS\"\r\n    }\r\n}\r\n\r\nexport type MenuStateListener = (update: ControllerState) => void;\r\n\r\nexport type CustomMessageHandler = (cmd: MenuCommand) => void;\r\n\r\nexport class MenuController {\r\n    private readonly menuTree: MenuTree;\r\n    private readonly protocolHandler: TcProtocolHandler;\r\n    private appInfo: AppInfo;\r\n    private componentsById: {[id: string]: MenuComponent} = {};\r\n    private lastHeartbeatRx: number;\r\n    private lastHeartbeatTx: number;\r\n    private hbFrequency: number = 1500;\r\n    private currentConnection: string = \"\";\r\n    private appName: string = \"\";\r\n    private appVersion: number = 0.0;\r\n    private appPlatform: ApiPlatform = ApiPlatform.JS_API;\r\n    private connector: APIConnector;\r\n    private dialogListener: DialogUpdateCallback|undefined;\r\n    private currentState: ControllerState = ControllerState.STOPPED;\r\n    private stateListener: MenuStateListener|undefined = undefined;\r\n    private pairingMode: boolean = false;\r\n    private customMessageHandler: CustomMessageHandler;\r\n\r\n    public constructor(connector: APIConnector, appInfo: AppInfo) {\r\n        this.appInfo = appInfo;\r\n        this.menuTree = new MenuTree((menuTree, id) => this.rebuildTree(false));\r\n        this.lastHeartbeatRx = this.lastHeartbeatTx = Date.now();\r\n        this.connector = connector;\r\n        this.protocolHandler = new TagValProtocolHandler(this.menuTree);\r\n        this.customMessageHandler = (m) => console.warn(`unhandled message on ${this.connector.getName()} - ${m}`);\r\n    }\r\n\r\n    private setCurrentState(state: ControllerState) {\r\n        this.currentState = state;\r\n        if(this.stateListener) this.stateListener(state);\r\n    }\r\n\r\n    public getCurrentState(): ControllerState {\r\n        return this.currentState;\r\n    }\r\n\r\n    public registerStateListener(l: MenuStateListener): void {\r\n        this.stateListener = l;\r\n        l(this.currentState);\r\n    }\r\n\r\n    public isRunning(): boolean {\r\n        return this.currentState !== ControllerState.STOPPED && this.currentState !== ControllerState.FAILED_AUTHENTICATION;\r\n    }\r\n\r\n    public start() {\r\n        if(this.isRunning()) return;\r\n        this.connector.registerMessageHandler((proto, msg) => this.messageProcessor(msg));\r\n        this.setCurrentState(ControllerState.NOT_CONNECTED);\r\n\r\n        this.connector.registerConnectionListener((connected, why) => {\r\n            if(connected) {\r\n                this.setCurrentState(ControllerState.CONNECTED);\r\n                this.lastHeartbeatRx = this.lastHeartbeatTx = Date.now();\r\n                this.sendMessage(\r\n                    this.protocolHandler.convertCommandToWire(new HeartbeatCommand(this.hbFrequency, HeartbeatMode.START))\r\n                );\r\n                if(this.pairingMode) {\r\n                    this.sendMessage(this.protocolHandler.convertCommandToWire(\r\n                        new PairingCommand(this.appInfo.getAppName(), this.appInfo.getAppUuid()))\r\n                    );\r\n                } else {\r\n                    this.sendMessage(this.protocolHandler.convertCommandToWire(\r\n                        new JoinCommand(this.appInfo.getAppName(), this.appInfo.getAppUuid(), ApiPlatform.JS_API, parseAppVersion()))\r\n                    );\r\n                }\r\n                this.menuTree.emptyTree();\r\n                this.rebuildTree(false);\r\n            }\r\n            else {\r\n                this.setCurrentState(ControllerState.NOT_CONNECTED);\r\n                this.menuTree.emptyTree();\r\n                this.rebuildTree(true);\r\n            }\r\n        })\r\n\r\n        this.checkHeartbeats();\r\n\r\n        this.tickAllElements();\r\n\r\n        this.connector.start();\r\n    }\r\n\r\n    public async attemptPairing(cb: PairingCallback): Promise<boolean> {\r\n        this.stop();\r\n        this.pairingMode = true;\r\n        this.start();\r\n        const startTime = Date.now();\r\n\r\n        try {\r\n            while ((Date.now() - startTime) < 60000) {\r\n                if (this.currentState === ControllerState.FAILED_AUTHENTICATION) return false;\r\n                if(this.currentState === ControllerState.PAIRED_OK) return true;\r\n                cb(niceState(this.currentState));\r\n                await delay(500);\r\n            }\r\n        }\r\n        finally {\r\n            this.stop();\r\n            this.pairingMode = false;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public stop() {\r\n        this.pairingMode = false;\r\n        this.setCurrentState(ControllerState.STOPPED);\r\n        this.connector?.closeConnection();\r\n        this.menuTree.emptyTree();\r\n        this.componentsById = {};\r\n    }\r\n\r\n    private tickAllElements() {\r\n        if(this.connector.isConnected()) {\r\n            const dt = Date.now();\r\n            Object.values(this.componentsById).forEach(comp => comp.tick(dt));\r\n\r\n        }\r\n        setTimeout(this.tickAllElements.bind(this), this.connector.isConnected() ? 100 : 1000);\r\n    }\r\n\r\n    private checkHeartbeats() {\r\n        const now = Date.now();\r\n        if(this.connector.isConnected() && (now - this.lastHeartbeatRx) > (this.hbFrequency * 3)) {\r\n            console.error(\"Connecting closing due to inactivity\" + this.connector.getName())\r\n            this.connector.closeConnection();\r\n        }\r\n\r\n        if(this.connector.isConnected() && (now - this.lastHeartbeatTx) > this.hbFrequency) {\r\n            this.sendMessage(this.protocolHandler.convertCommandToWire(\r\n                new HeartbeatCommand(this.hbFrequency, HeartbeatMode.NORMAL)\r\n            ));\r\n        }\r\n\r\n        if(!this.connector.isConnected() && (now - this.connector.lastDisconnectTime()) > (this.pairingMode ? 4000 : 8000)) {\r\n            this.connector.start();\r\n        }\r\n\r\n        if(this.isRunning()) setTimeout( () => this.checkHeartbeats(), 500);\r\n    }\r\n\r\n    public getTree() { return this.menuTree; }\r\n\r\n    public getMenuName(): string {\r\n        if(this.connector.isConnected()) {\r\n            return this.appName + \", V\" + this.appVersion + \" \" + nicePlatform(this.appPlatform);\r\n        }\r\n        else {\r\n            return \"Lost connection\";\r\n        }\r\n    }\r\n\r\n    private rebuildTree(cleanComponents: boolean) {\r\n        if(cleanComponents) {\r\n            console.info(\"Cleaning down components\");\r\n            let rootId = this.menuTree.getRoot().getMenuId();\r\n            let rootComponent = this.componentsById[rootId];\r\n            this.componentsById = {};\r\n            if(rootComponent) this.componentsById[rootId] = rootComponent;\r\n        }\r\n\r\n        if(this.currentState === ControllerState.READY) {\r\n            Object.values(this.componentsById).forEach(comp => comp.structureHasChanged());\r\n        }\r\n    }\r\n\r\n    public putMenuComponent(id: string, comp: MenuComponent) {\r\n        this.componentsById[id] = comp;\r\n    }\r\n\r\n    sendActionableUpdate(itemId: string): number|undefined {\r\n        try {\r\n            let item = this.menuTree.getMenuItemFor(itemId);\r\n            if (!item) return undefined;\r\n            const val = (item instanceof BooleanMenuItem) ? !item.getCurrentValue() : false;\r\n            const correlation = makeCorrelation();\r\n            this.sendMessage(this.protocolHandler.convertCommandToWire(\r\n                new ItemChangeCommand(item.getMenuId(), ChangeType.ABSOLUTE, val ? \"1\":\"0\", correlation.toString(16))\r\n            ));\r\n\r\n            return correlation;\r\n        }\r\n        catch(e) {\r\n            console.error(`Action update was not sent for ${itemId}`);\r\n            this.connector.closeConnection();\r\n        }\r\n    }\r\n\r\n    sendListResponseUpdate(itemId: string, row: number, doubleClick: boolean): number|undefined {\r\n        try {\r\n            let correlation = makeCorrelation();\r\n            const listResponse = row.toString() + \":\" + (doubleClick ? \"1\" : \"0\");\r\n            this.sendMessage(this.protocolHandler.convertCommandToWire(\r\n                new ItemChangeCommand(itemId, ChangeType.LIST_SELECTION, listResponse, correlation.toString(16))\r\n            ));\r\n            return correlation;\r\n        }\r\n        catch (e) {\r\n            console.error(\"List response was not sent for \" + itemId + \" row \" + row);\r\n            this.connector.closeConnection();\r\n        }\r\n    }\r\n\r\n    sendAbsoluteUpdate(itemId: string, amt: string): number|undefined {\r\n        try {\r\n            const item = this.menuTree.getMenuItemFor(itemId);\r\n            const correlation = makeCorrelation();\r\n            this.sendMessage(this.protocolHandler.convertCommandToWire(\r\n                new ItemChangeCommand(item.getMenuId(), ChangeType.ABSOLUTE, amt, correlation.toString(16))\r\n            ));\r\n            return correlation;\r\n        }\r\n        catch (e) {\r\n            console.error(`Update was not sent for ${itemId} change ${amt}`, e);\r\n            this.connector.closeConnection();\r\n        }\r\n    }\r\n\r\n    sendDialogAction(button: ButtonType): number|undefined {\r\n        try {\r\n            const correlation = makeCorrelation();\r\n            this.sendMessage(this.protocolHandler.convertCommandToWire(\r\n                new DialogUpdateCommand(DialogMode.ACTION, \"\", \"\", button, button, correlation.toString(16))\r\n            ));\r\n            return correlation;\r\n        }\r\n        catch (e) {\r\n            console.error(`Dialog action not sent for ${button}`, e);\r\n            this.connector.closeConnection();\r\n        }\r\n    }\r\n\r\n    sendDeltaUpdate(itemId: string, amt: number): number|undefined {\r\n        try {\r\n            const correlation = makeCorrelation();\r\n            let item = this.menuTree.getMenuItemFor(itemId);\r\n            if(item instanceof ScrollChoiceMenuItem) {\r\n                let sp = item.getCurrentValue();\r\n                sp.currentPos += amt;\r\n                this.sendMessage(this.protocolHandler.convertCommandToWire(\r\n                    new ItemChangeCommand(item.getMenuId(), ChangeType.ABSOLUTE, sp.asString(), correlation.toString(16))\r\n                ));\r\n                return correlation;\r\n            } else if ((item instanceof AnalogMenuItem) || (item instanceof EnumMenuItem)) {\r\n                this.sendMessage(this.protocolHandler.convertCommandToWire(\r\n                    new ItemChangeCommand(item.getMenuId(), ChangeType.DELTA, amt.toFixed(0), correlation.toString(16))\r\n                ));\r\n                return correlation;\r\n            }\r\n        }\r\n        catch(e) {\r\n            console.error(`Delta update was not sent for ${itemId} change ${amt}`, e);\r\n            this.connector.closeConnection();\r\n        }\r\n    }\r\n\r\n    private messageProcessor(msg: string): void {\r\n        const possibleMsg = this.protocolHandler.convertWireToCommand(msg);\r\n        if(!possibleMsg) return;\r\n        this.lastHeartbeatRx = Date.now();\r\n\r\n        switch (possibleMsg.commandType) {\r\n            case MenuCommandType.JOIN:\r\n                this.joinReceived(possibleMsg as JoinCommand);\r\n                break;\r\n            case MenuCommandType.CHANGE_INT_FIELD:\r\n                this.itemHasUpdated(possibleMsg as ItemChangeCommand);\r\n                break;\r\n            case MenuCommandType.HEARTBEAT:\r\n                this.heartbeatReceived(possibleMsg as HeartbeatCommand);\r\n                break;\r\n            case MenuCommandType.PAIRING_REQUEST:\r\n                this.pairingRequest(possibleMsg as PairingCommand);\r\n                break;\r\n            case MenuCommandType.DIALOG_UPDATE:\r\n                this.dialogHasUpdated(possibleMsg as DialogUpdateCommand);\r\n                break;\r\n            case MenuCommandType.BOOTSTRAP:\r\n                this.bootstrapEvent(possibleMsg as BootstrapCommand);\r\n                break;\r\n            case MenuCommandType.ACKNOWLEDGEMENT:\r\n                this.acknowledgement(possibleMsg as AcknowledgmentCommand);\r\n                break;\r\n            case MenuCommandType.BOOT_SCROLL_CHOICE:\r\n            case MenuCommandType.BOOT_RGB_COLOR:\r\n            case MenuCommandType.ENUM_BOOT_ITEM:\r\n            case MenuCommandType.LARGE_NUM_BOOT_ITEM:\r\n            case MenuCommandType.ANALOG_BOOT_ITEM:\r\n            case MenuCommandType.BOOLEAN_BOOT_ITEM:\r\n            case MenuCommandType.FLOAT_BOOT_ITEM:\r\n            case MenuCommandType.RUNTIME_LIST_BOOT:\r\n            case MenuCommandType.TEXT_BOOT_ITEM:\r\n            case MenuCommandType.ACTION_BOOT_ITEM:\r\n            case MenuCommandType.SUBMENU_BOOT_ITEM:\r\n                console.info(\"Incoming boot command rx but already processed by protocol\", possibleMsg.commandType);\r\n                break;\r\n            default:\r\n                this.customMessageHandler(possibleMsg);\r\n                break;\r\n        }\r\n    }\r\n\r\n    public heartbeatReceived(hb: HeartbeatCommand) {\r\n        this.hbFrequency = hb.frequency;\r\n        console.log(\"hbrx: \" + hb.mode + \", freq: \" + hb.frequency);\r\n    }\r\n\r\n    public pairingRequest(pair: PairingCommand) {\r\n        console.log(\"Pair: \" + pair.appName + \", uuid: \" + pair.appUuid);\r\n    }\r\n\r\n    dialogHasUpdated(dlg: DialogUpdateCommand) {\r\n        if(this.dialogListener) this.dialogListener(dlg.mode === DialogMode.SHOW, dlg.header, dlg.buffer,\r\n            dlg.button1, dlg.button2);\r\n    }\r\n\r\n    joinReceived(join: JoinCommand) {\r\n        this.currentConnection = join.name;\r\n        this.appName = join.name;\r\n        this.appVersion = join.version;\r\n        this.appPlatform = join.platform;\r\n        this.componentsById[\"0\"].structureHasChanged();\r\n\r\n        console.log(\"join: \" + this.appName + \", uuid: \" + join.uuid + \", platform: \" + this.appPlatform + \", ver: \" + this.appVersion);\r\n    }\r\n\r\n    public bootstrapEvent(evt: BootstrapCommand) {\r\n        let gotStart = (evt.bootstrapMode === BootstrapMode.START);\r\n        this.setCurrentState(gotStart ? ControllerState.BOOTSTRAP : ControllerState.READY);\r\n        if(!gotStart) this.rebuildTree(false);\r\n\r\n        console.debug(\"Boot event \" + evt.bootstrapMode);\r\n    }\r\n\r\n    public acknowledgement(ack: AcknowledgmentCommand) {\r\n        console.debug(\"acknowledgement received \" + ack.correlation + \" - \" + ack.status);\r\n        if(ack.correlation && parseInt(ack.correlation, 16) > 0) {\r\n            Object.values(this.componentsById).forEach(item => item.ackReceived(parseInt(ack.correlation, 16), ack.status));\r\n        }\r\n        else if(this.currentState === ControllerState.CONNECTED) {\r\n            if(ack.status !== AckStatus.SUCCESS) {\r\n                this.setCurrentState(ControllerState.FAILED_AUTHENTICATION);\r\n            }\r\n            else if(this.pairingMode) {\r\n                this.setCurrentState(ControllerState.PAIRED_OK);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    itemHasUpdated(chg: ItemChangeCommand) {\r\n        let item = this.menuTree.getMenuItemFor(chg.menuId);\r\n        if(!item) return;\r\n        switch(item.messageType) {\r\n            case \"Analog\":\r\n            case \"Enum\":\r\n                item.setCurrentValue(parseInt(chg.value.toString(), 10));\r\n                break;\r\n            case \"LargeNum\":\r\n                item.setCurrentValue(parseFloat(chg.value.toString()));\r\n                break;\r\n            case \"Boolean\":\r\n                item.setCurrentValue(parseInt(chg.value.toString()));\r\n                break;\r\n            case \"Scroll\":\r\n                item.setCurrentValue(ScrollChoice.fromString(chg.value.toString()));\r\n                break;\r\n            case \"List\":\r\n                item.setCurrentValue(chg.value as string[]);\r\n                break;\r\n            default:\r\n                item.setCurrentValue(chg.value.toString());\r\n                break;\r\n        }\r\n        this.componentsById[chg.menuId]?.itemHasUpdated();\r\n    }\r\n\r\n    public sendMessage(data: string) {\r\n        try {\r\n            console.debug(`Sending message to ${this.connector.getName()} content: ${toPrintableMessage(data)}`);\r\n            this.connector.sendMessage(data);\r\n            this.lastHeartbeatTx = Date.now();\r\n        }\r\n        catch(e) {\r\n            console.log(\"Exception caught during send: \" + e);\r\n            this.connector.closeConnection();\r\n        }\r\n    }\r\n\r\n    public registerCustomMessageHandler(customHandler: CustomMessageHandler): void {\r\n        this.customMessageHandler = customHandler;\r\n    }\r\n\r\n    registerDialogListener(listener: DialogUpdateCallback) {\r\n        this.dialogListener = listener;\r\n    }\r\n}\r\n\r\nfunction delay(ms: number) {\r\n    return new Promise( resolve => setTimeout(resolve, ms) );\r\n}\r\n\r\nfunction parseAppVersion(): number {\r\n    const rawVersion = process.env.REACT_APP_VERSION;\r\n    if(!rawVersion) return 0;\r\n\r\n    const regex = /(\\d+)\\.(\\d+).*/;\r\n    const match = rawVersion.match(regex);\r\n    if(match && match.length > 1) {\r\n        return (parseInt(match[0]) * 100) + parseInt(match[1]);\r\n    }\r\n    return 0;\r\n}","import {\r\n    AnalogMenuItem,\r\n    BooleanMenuItem,\r\n    BooleanNaming,\r\n    EditableLargeNumberMenuItem,\r\n    EditableTextMenuItem,\r\n    EnumMenuItem,\r\n    FloatMenuItem, ListMenuItem,\r\n    MenuItem,\r\n    Rgb32MenuItem,\r\n    ScrollChoiceMenuItem, TextEditMode\r\n} from \"./MenuItem\";\r\nimport {TcProtocolError} from \"./protocol/TagValProtocol\";\r\n\r\nfunction isTrue(currentValue: string): boolean {\r\n    return currentValue.charAt(0) === \"Y\" || currentValue.charAt(0) === \"1\" || currentValue.charAt(0) === \"T\";\r\n}\r\n\r\nexport function formatStringToWire(item: MenuItem<any>, currentValue: string): string {\r\n    if(item instanceof AnalogMenuItem) {\r\n        let num = parseFloat(currentValue);\r\n        num = Math.round((num * item.getDivisor()) - item.getOffset());\r\n        if(num < 0 || num > item.getMaxValue()) throw new TcProtocolError(`Number ${num} outside of 0..${item.getMaxValue()}`);\r\n        return num.toFixed(0);\r\n    }\r\n    else if(item instanceof EnumMenuItem) {\r\n        let num = parseInt(currentValue);\r\n        if(num < 0 || num >= item.getItemList().length) throw new TcProtocolError(`Enum ${num} outside allowable range`);\r\n        return item.getCurrentValue().toFixed(0);\r\n    }\r\n    else if(item instanceof BooleanMenuItem) return isTrue(currentValue) ? \"1\" : \"0\";\r\n    else if(item instanceof EditableLargeNumberMenuItem) {\r\n        let flt = parseFloat(currentValue);\r\n        if(flt < 0 && !item.isNegativeAllowed()) throw new TcProtocolError(\"Negative value not allowed\");\r\n        return flt.toFixed(item.getDecimalPlaces());\r\n    }\r\n    else if(item instanceof EditableTextMenuItem) {\r\n        return formatEditableTextWire(item, currentValue);\r\n    }\r\n    else if(item instanceof Rgb32MenuItem) {\r\n        if(!currentValue.match(\"#[0-9A-Fa-f]*\")) throw new TcProtocolError(\"Not in HTML color format\");\r\n        return currentValue;\r\n    }\r\n    else if(item instanceof ScrollChoiceMenuItem)  {\r\n        let num = parseInt(currentValue);\r\n        return num.toFixed(0) + \"-\";\r\n    }\r\n    else throw new TcProtocolError(\"Unknown type of item for text conversion\");\r\n}\r\n\r\nexport function formatForDisplay(item: MenuItem<any>): string {\r\n    if(item instanceof FloatMenuItem) return item.getCurrentValue().toFixed(item.getDecimalPlaces());\r\n    else if(item instanceof AnalogMenuItem) return formatAnalogItem(item);\r\n    else if(item instanceof EnumMenuItem) return item.getItemList()[item.getCurrentValue()];\r\n    else if(item instanceof BooleanMenuItem) return formatBooleanItem(item);\r\n    else if(item instanceof EditableTextMenuItem) return item.getCurrentValue();\r\n    else if(item instanceof EditableLargeNumberMenuItem) return item.getCurrentValue().toFixed(item.getDecimalPlaces());\r\n    else if(item instanceof Rgb32MenuItem) return item.getCurrentValue();\r\n    else if(item instanceof ScrollChoiceMenuItem) return item.getCurrentValue().currentValue;\r\n    else if(item instanceof ListMenuItem) return Object.values(item.getCurrentValue()).join(\", \");\r\n    else return \"\";\r\n}\r\n\r\nfunction formatBooleanItem(item: BooleanMenuItem) {\r\n    let curr = item.getCurrentValue();\r\n    switch(item.getNaming()) {\r\n        case BooleanNaming.YES_NO: return curr ? \"YES\" : \"NO\";\r\n        case BooleanNaming.ON_OFF: return curr ? \"ON\" : \"OFF\";\r\n        default: return curr ? \"TRUE\" : \"FALSE\";\r\n    }\r\n}\r\n\r\nfunction getActualDecimalDivisor(divisor: number): number {\r\n    if (divisor < 2) return 1;\r\n    return (divisor > 1000) ? 10000 : (divisor > 100) ? 1000 : (divisor > 10) ? 100 : 10;\r\n}\r\n\r\nfunction calculateRequiredDigits(divisor: number) {\r\n    return (divisor <= 10) ? 1 : (divisor <= 100) ? 2 : (divisor <= 1000) ? 3 : 4;\r\n}\r\n\r\nfunction formatAnalogItem(an: AnalogMenuItem) {\r\n    let calcVal = an.getCurrentValue() + an.getOffset();\r\n    let divisor = an.getDivisor();\r\n\r\n    if (divisor < 2)  {\r\n        return calcVal.toFixed(0);\r\n    } else {\r\n        let whole = Math.floor(calcVal / divisor);\r\n        let fractMax = getActualDecimalDivisor(an.getDivisor());\r\n        let fraction = (Math.abs((calcVal % divisor)) * (fractMax / divisor)).toFixed(0);\r\n        return whole.toFixed(0) + \".\" + fraction.padStart(calculateRequiredDigits(divisor), \"0\") + an.getUnitName();\r\n    }\r\n}\r\n\r\nfunction formatEditableTextWire(et: EditableTextMenuItem, val: string)  {\r\n    if(et.getEditMode() === TextEditMode.PLAIN_TEXT) {\r\n        if(val.length > et.getTextLength()) throw new TcProtocolError(\"Text too long\");\r\n        return val;\r\n    }\r\n    else if(et.getEditMode() === TextEditMode.IP_ADDRESS)\r\n    {\r\n        if (!val.match(\"\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+\")) throw new TcProtocolError(\"Not an IPV4 address\");\r\n        return val;\r\n    }\r\n    else if(et.getEditMode() === TextEditMode.TIME_24H || et.getEditMode() === TextEditMode.TIME_24_HUNDREDS || et.getEditMode() === TextEditMode.TIME_12H)\r\n    {\r\n        // time is always sent back to the server in 24 hour format, it is always possible (but optional) to provide hundreds/sec.\r\n        if (!val.match(\"\\\\d+:\\\\d+:\\\\d+(.\\\\d*)*\")) throw new TcProtocolError(\"Not in the correct time format\");\r\n        return val;\r\n    }\r\n    else if (et.getEditMode() === TextEditMode.GREGORIAN_DATE)\r\n    {\r\n        if (!val.match(\"\\\\d+/\\\\d+/\\\\d+\")) throw new TcProtocolError(\"Not a date\");\r\n        return val;\r\n    }\r\n    return \"\";\r\n}\r\n","export default __webpack_public_path__ + \"static/media/pairing.63065c5a.webp\";","import {Component} from \"react\";\r\nimport pairingImg from './img/pairing.webp';\r\nimport {MenuController} from \"./api/MenuController\";\r\n\r\nenum PairingMode { NOT_STARTED, STARTED, DONE}\r\ntype PairingPanelProps = { controller: MenuController };\r\ntype PairingPanelState = { buttonText: string, pairingMode: PairingMode };\r\n\r\nexport class PairingPanel extends Component<PairingPanelProps, PairingPanelState> {\r\n\r\n    constructor(props: Readonly<PairingPanelProps> | PairingPanelProps) {\r\n        super(props);\r\n        this.state = {buttonText: \"Start pairing with device\", pairingMode: PairingMode.NOT_STARTED};\r\n        this.pairingButtonClicked = this.pairingButtonClicked.bind(this);\r\n    }\r\n\r\n    async pairingButtonClicked() {\r\n        if(this.state.pairingMode === PairingMode.NOT_STARTED) {\r\n            const paired = await this.props.controller.attemptPairing((update: string) => {\r\n                this.setState({buttonText: update, pairingMode: PairingMode.STARTED});\r\n            });\r\n            if(paired) {\r\n                this.setState({buttonText: \"Successfully paired, close\", pairingMode: PairingMode.DONE});\r\n            }\r\n            else {\r\n                this.setState({buttonText: \"Failed, try pairing again\", pairingMode: PairingMode.NOT_STARTED});\r\n            }\r\n        }\r\n        else if(this.state.pairingMode === PairingMode.STARTED) {\r\n            this.props.controller.stop();\r\n        }\r\n        else {\r\n            window.location.reload();\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return <div>\r\n            <h2>Device requires pairing</h2>\r\n            <img src={pairingImg} className=\"pairing-image\" alt=\"Example pairing screen on device\"/>\r\n            <p>This device only allows authorized connections, you need to pair with the device in order to monitor and\r\n                control it. Make sure that the device is within reach as you will need to press 'Accept' on the device itself.</p>\r\n            <p>An example of how the pairing screen will look is presented above, pressing accept gives this connection complete\r\n                control of the device. Ensure you only ever press accept when you are pairing yourself.</p>\r\n            <div>\r\n                <button className=\"settingsButton\" onClick={this.pairingButtonClicked}>{this.state.buttonText}</button>\r\n            </div>\r\n        </div>;\r\n    }\r\n}","import React, {Component} from \"react\";\r\nimport {FloatMenuItem, ListMenuItem, MenuItem, Rgb32MenuItem, SubMenuItem} from \"./api/MenuItem\";\r\nimport {ControllerState, MenuComponent, MenuController} from \"./api/MenuController\";\r\nimport {formatForDisplay, formatStringToWire} from \"./api/MenuItemFormatter\";\r\nimport {AckStatus, isAckStatusError} from \"./api/protocol/TagValEnums\";\r\nimport {PairingPanel} from \"./PairingPanel\";\r\n\r\nenum MenuUIState { READY, PENDING_UPDATE, RECENT_UPDATE, UPDATE_ERROR }\r\nconst UPDATE_HIGHLIGHT_TIME = 1000;\r\nconst MAXIMUM_WAIT_FOR_CORRELATION = 3000;\r\n\r\nexport class BaseMenuUI extends Component<{ itemId: string, controller: MenuController }, { value: string }> implements MenuComponent {\r\n    protected itemName: string = \"\";\r\n    protected itemId: string = \"\";\r\n    protected readOnly: boolean = false;\r\n    protected lastUpdate: number = Date.now();\r\n    protected itemState: MenuUIState = MenuUIState.READY;\r\n    protected outstandingCorrelation: number = 0;\r\n\r\n    constructor(props: { itemId: string, controller: MenuController }) {\r\n        super(props);\r\n        this.bindAllControls();\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.updateItem();\r\n    }\r\n\r\n    private updateItem() {\r\n        let item = this.props.controller.getTree().getMenuItemFor(this.props.itemId);\r\n        if (item) {\r\n            this.props.controller.putMenuComponent(item.getMenuId(), this);\r\n            if(this.itemState === MenuUIState.READY) this.itemState = MenuUIState.RECENT_UPDATE;\r\n            this.lastUpdate = Date.now();\r\n            this.internalUpdateItem(item);\r\n        }\r\n    }\r\n\r\n    ackReceived(correlationId: number, ackStatus: AckStatus) {\r\n        if(correlationId === this.outstandingCorrelation) {\r\n            this.outstandingCorrelation = 0;\r\n            this.itemState = isAckStatusError(ackStatus) ? MenuUIState.UPDATE_ERROR : MenuUIState.RECENT_UPDATE;\r\n            this.forceUpdate();\r\n        }\r\n    }\r\n\r\n    tick(timeNow: number): void {\r\n        const ticks = timeNow - this.lastUpdate;\r\n        if(this.itemState === MenuUIState.PENDING_UPDATE) {\r\n            if(ticks > MAXIMUM_WAIT_FOR_CORRELATION) {\r\n                this.itemState = MenuUIState.UPDATE_ERROR;\r\n                this.outstandingCorrelation = 0;\r\n                this.lastUpdate = Date.now();\r\n                this.forceUpdate();\r\n            }\r\n        }\r\n        else if(this.itemState !== MenuUIState.READY && ticks > UPDATE_HIGHLIGHT_TIME) {\r\n            this.itemState = MenuUIState.READY;\r\n            this.forceUpdate();\r\n        }\r\n    }\r\n\r\n    calculatedClass(baseClass: string): string {\r\n        switch(this.itemState) {\r\n            case MenuUIState.PENDING_UPDATE: return baseClass + \" pendingUpdate\";\r\n            case MenuUIState.RECENT_UPDATE: return baseClass + \" itemHasUpdated\";\r\n            case MenuUIState.UPDATE_ERROR: return baseClass + \" errorDuringUpdate\";\r\n            default: return baseClass;\r\n        }\r\n    }\r\n\r\n    internalUpdateItem(item: MenuItem<any>) {\r\n        if (item.getMenuId() === \"0\") {\r\n            this.itemName = this.props.controller.getMenuName();\r\n        } else {\r\n            this.itemName = item.getItemName();\r\n        }\r\n        this.itemId = item.getMenuId();\r\n        this.readOnly = item.isReadOnly() || (item instanceof FloatMenuItem);\r\n    }\r\n\r\n    bindAllControls(): void {\r\n    }\r\n\r\n    structureHasChanged() {\r\n        this.updateItem();\r\n        this.forceUpdate();\r\n    }\r\n\r\n    itemHasUpdated(): void {\r\n        this.updateItem();\r\n        this.forceUpdate()\r\n    }\r\n\r\n    markRecentlyUpdated(correlationId: number|undefined): void {\r\n        this.lastUpdate = Date.now();\r\n        if(correlationId) {\r\n            this.itemState = MenuUIState.PENDING_UPDATE;\r\n            this.outstandingCorrelation = correlationId;\r\n        }\r\n        else {\r\n            this.itemState = MenuUIState.UPDATE_ERROR;\r\n            this.outstandingCorrelation = 0;\r\n        }\r\n        this.forceUpdate();\r\n    }\r\n}\r\n\r\nexport class SubMenuUI extends BaseMenuUI {\r\n    protected renderableChildren: Array<MenuItem<any>> = [];\r\n    private isExpanded: boolean = true;\r\n\r\n    internalUpdateItem(item: SubMenuItem) {\r\n        super.internalUpdateItem(item);\r\n        this.renderableChildren = item.getChildren();\r\n        this.setState( { value: \"\" });\r\n    }\r\n\r\n    bindAllControls(): void {\r\n        this.toggleExpand = this.toggleExpand.bind(this);\r\n    }\r\n\r\n    toggleExpand() {\r\n        this.isExpanded = !this.isExpanded;\r\n        this.forceUpdate();\r\n    }\r\n\r\n    render() {\r\n        const listItems = this.renderableChildren.filter((it) => it.isVisible()).map((ch) => {\r\n            switch (ch.messageType) {\r\n                case \"Sub\":\r\n                    return <SubMenuUI controller={this.props.controller} itemId={ch.getMenuId()}/>;\r\n                case \"Boolean\":\r\n                case \"Action\":\r\n                    return <ActionableTextMenuItem itemId={ch.getMenuId()} controller={this.props.controller}/>\r\n                case \"Analog\":\r\n                case \"Enum\":\r\n                case \"Scroll\":\r\n                    return <UpDownEditorUI controller={this.props.controller} itemId={ch.getMenuId()}/>\r\n                case \"Rgb32\":\r\n                    return <Rgb32ColorEditor itemId={ch.getMenuId()} controller={this.props.controller}/>\r\n                case \"List\":\r\n                    return <ListMenuItemUI itemId={ch.getMenuId()} controller={this.props.controller}/>\r\n                default:\r\n                    return <TextBasedMenuUI controller={this.props.controller} itemId={ch.getMenuId()}/>\r\n            }\r\n        });\r\n\r\n        return <div>\r\n            <div className=\"subMenu\">\r\n                <h3>\r\n                    <button onClick={this.toggleExpand}>{this.isExpanded ? \"-\" : \"+\"}</button>\r\n                    {this.itemName}\r\n                </h3>\r\n                <div className={this.isExpanded ? \"subShown\" : \"subHidden\" }>{listItems}</div>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\nexport class RootSubMenuUI extends SubMenuUI {\r\n    private pairingMode: boolean = false;\r\n\r\n    bindAllControls() {\r\n        this.props.controller.registerStateListener((state: ControllerState) => {\r\n            if (state === ControllerState.FAILED_AUTHENTICATION) {\r\n                this.pairingMode = true;\r\n            }\r\n            this.itemHasUpdated();\r\n        });\r\n    }\r\n\r\n    render() {\r\n        if (this.pairingMode) {\r\n            return <PairingPanel controller={this.props.controller}/>\r\n        } else return super.render();\r\n    }\r\n}\r\n\r\nexport class UpDownEditorUI extends BaseMenuUI {\r\n\r\n    internalUpdateItem(item: MenuItem<any>) {\r\n        super.internalUpdateItem(item);\r\n        this.setState({value: formatForDisplay(item) });\r\n    }\r\n\r\n    bindAllControls() {\r\n        this.sendDecrease = this.sendDecrease.bind(this);\r\n        this.sendIncrease = this.sendIncrease.bind(this);\r\n    }\r\n\r\n    sendDecrease() {\r\n        const correlation = this.props.controller?.sendDeltaUpdate(this.props.itemId, -1);\r\n        this.markRecentlyUpdated(correlation);\r\n    }\r\n\r\n    sendIncrease() {\r\n        const correlation = this.props.controller?.sendDeltaUpdate(this.props.itemId, 1);\r\n        this.markRecentlyUpdated(correlation);\r\n    }\r\n\r\n    render() {\r\n        return <div className={this.calculatedClass(\"upDownControl\")}>\r\n            <button className=\"leftBtn\" disabled={this.readOnly} onClick={this.sendDecrease}>&lt;</button>\r\n            <button className=\"rightBtn\" disabled={this.readOnly} onClick={this.sendIncrease}>&gt;</button>\r\n            <span>{this.itemName}: {this.state?.value}</span>\r\n        </div>\r\n    }\r\n}\r\n\r\nexport class TextBasedMenuUI extends BaseMenuUI {\r\n    private editingMode:boolean = false;\r\n    private rollbackValue:string = \"\";\r\n\r\n    bindAllControls() {\r\n        this.startEditing = this.startEditing.bind(this);\r\n        this.cancelPressed = this.cancelPressed.bind(this);\r\n        this.submitPressed = this.submitPressed.bind(this);\r\n        this.textHasChanged = this.textHasChanged.bind(this);\r\n    }\r\n\r\n    startEditing() {\r\n        this.editingMode = true;\r\n        this.itemHasUpdated();\r\n        this.rollbackValue = this.state.value;\r\n    }\r\n\r\n    cancelPressed() {\r\n        this.editingMode = false;\r\n        this.setState({ value: this.rollbackValue });\r\n        this.itemHasUpdated();\r\n    }\r\n\r\n    submitPressed() {\r\n        try {\r\n            this.editingMode = false;\r\n            let item = this.props.controller.getTree().getMenuItemFor(this.props.itemId);\r\n            const correlation = this.props.controller.sendAbsoluteUpdate(this.props.itemId, formatStringToWire(item, this.state.value));\r\n            this.markRecentlyUpdated(correlation);\r\n        }\r\n        catch(e) {\r\n            alert(\"Problem submitting value: \" + e);\r\n            console.error(\"Problem during submit of value\");\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    textHasChanged(event: React.FormEvent<HTMLInputElement>) {\r\n        this.setState({ value: event.currentTarget.value});\r\n    }\r\n\r\n    internalUpdateItem(item: FloatMenuItem) {\r\n        super.internalUpdateItem(item);\r\n        this.setState({value: formatForDisplay(item)} );\r\n    }\r\n\r\n    render() {\r\n        if (this.editingMode) {\r\n            return <div className=\"upDownControl\">\r\n                <button className=\"rightBtn\" disabled={this.readOnly} onClick={this.submitPressed}>Submit</button>\r\n                <button className=\"rightBtn\" onClick={this.cancelPressed}>Cancel</button>\r\n                <form >\r\n                    <label>{this.itemName}\r\n                    <input type=\"text\" value={this.state?.value} onChange={this.textHasChanged}/>\r\n                    </label>\r\n                </form>\r\n            </div>\r\n        } else {\r\n            return <div className={this.calculatedClass(\"upDownControl\")}>\r\n                <button className=\"rightBtn\" onClick={this.startEditing}>Edit</button>\r\n                <div>{this.itemName}: {this.state?.value}</div>\r\n            </div>\r\n        }\r\n    }\r\n}\r\n\r\nexport class ListItemRowUI extends Component<{itemId: string, row: number, text: string, controller: MenuController}, any> {\r\n\r\n    render() {\r\n        return <button className=\"listElementButton\" onClick={(e) =>\r\n            this.props.controller.sendListResponseUpdate(this.props.itemId, this.props.row, e.detail > 1)\r\n        }>{this.props.text}</button>;\r\n    }\r\n}\r\n\r\nexport class ListMenuItemUI extends BaseMenuUI {\r\n    private itemList = Array<string>();\r\n\r\n    internalUpdateItem(item: MenuItem<any>) {\r\n        super.internalUpdateItem(item);\r\n        this.setState({ value: \"\" });\r\n        if(item instanceof ListMenuItem) {\r\n            this.itemList = item.getCurrentValue();\r\n        }\r\n        this.forceUpdate();\r\n    }\r\n\r\n    render() {\r\n        let rowNum = 0;\r\n        const listItems = this.itemList.map((data) => <ListItemRowUI itemId={this.itemId} controller={this.props.controller} row={rowNum++} text={data}/>);\r\n        return <div className={this.calculatedClass(\"upDownControl\")}>\r\n            <p>{this.itemName}</p>\r\n            <ul>\r\n                {listItems}\r\n            </ul>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class ActionableTextMenuItem extends BaseMenuUI {\r\n\r\n    bindAllControls() {\r\n        this.buttonPressed = this.buttonPressed.bind(this);\r\n    }\r\n\r\n    internalUpdateItem(item: MenuItem<any>) {\r\n        super.internalUpdateItem(item);\r\n        const extraTxt = (item.messageType !== \"Action\") ? (\": \" + formatForDisplay(item)) : \"\";\r\n        this.setState({ value: extraTxt });\r\n    }\r\n\r\n    buttonPressed() {\r\n        const correlation = this.props.controller.sendActionableUpdate(this.props.itemId);\r\n        this.markRecentlyUpdated(correlation);\r\n    }\r\n\r\n    render() {\r\n        return <button disabled={this.readOnly} className={this.calculatedClass(\"actionableItem\")} onClick={this.buttonPressed}>{this.itemName}{this.state?.value}</button>\r\n    }\r\n}\r\n\r\nexport class Rgb32ColorEditor extends BaseMenuUI {\r\n    private editingStarted: boolean = false;\r\n\r\n    bindAllControls() {\r\n        this.editingRequested = this.editingRequested.bind(this);\r\n        this.submitPressed = this.submitPressed.bind(this);\r\n        this.colorHasChanged = this.colorHasChanged.bind(this);\r\n    }\r\n\r\n    internalUpdateItem(item: Rgb32MenuItem) {\r\n        super.internalUpdateItem(item);\r\n        this.setState({value: item.getCurrentValue()} );\r\n    }\r\n\r\n    editingRequested() {\r\n        this.editingStarted = true;\r\n        this.itemHasUpdated();\r\n    }\r\n\r\n    colorHasChanged(event: React.FormEvent<HTMLInputElement>) {\r\n        this.setState({ value: event.currentTarget.value });\r\n    }\r\n\r\n    submitPressed() {\r\n        try {\r\n            this.editingStarted = false;\r\n            let item = this.props.controller.getTree().getMenuItemFor(this.props.itemId);\r\n            const correlation = this.props.controller.sendAbsoluteUpdate(this.props.itemId, formatStringToWire(item, this.state.value));\r\n            this.markRecentlyUpdated(correlation);\r\n        }\r\n        catch(e) {\r\n            alert(\"Problem submitting value: \" + e);\r\n            console.error(\"Problem during submit of value\");\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const colStyle = {\r\n            backgroundColor: this.state?.value,\r\n        };\r\n\r\n        if(this.editingStarted) {\r\n            return <div className=\"upDownControl colorControl\" style={colStyle}>\r\n                <button className=\"rightBtn\" onClick={this.submitPressed}>Submit</button>\r\n                <form>\r\n                    <label>\r\n                        Select color:\r\n                    </label>\r\n                    <input type=\"color\" value={this.state?.value} onChange={this.colorHasChanged}/>\r\n                </form>\r\n            </div>\r\n        } else {\r\n            return <div className={this.calculatedClass(\"upDownControl colorControl\")} style={colStyle}>\r\n                <button disabled={this.readOnly} className=\"rightBtn\" onClick={this.editingRequested}>Change</button>\r\n                <div>{this.state?.value}</div>\r\n            </div>\r\n        }\r\n    }\r\n}","import {APIConnectionListener, APIConnector, APIMessageHandler} from \"../MenuController\";\r\nimport {PROTOCOL_TAG_VAL, TAG_END_OF_MSG, TAG_START_OF_MSG} from \"../protocol/TagValProtocol\";\r\n\r\nenum CurrentSocketState {\r\n    DISCONNECTED, CONNECTING, CONNECTED, STOPPED\r\n}\r\n\r\nexport class WebSocketConnector implements APIConnector {\r\n    url: string;\r\n    connectionListener: APIConnectionListener|undefined = undefined;\r\n    messageHandler: APIMessageHandler|undefined = undefined;\r\n    socket: WebSocket|undefined = undefined;\r\n    state: CurrentSocketState = CurrentSocketState.DISCONNECTED;\r\n    lastDisconnect: number = 0;\r\n    currentData: string = \"\";\r\n\r\n    constructor(url: string) {\r\n        this.url = url;\r\n    }\r\n\r\n    start(): void {\r\n        if(this.state === CurrentSocketState.CONNECTING)  return;\r\n        console.info(`Start connection to ${this.getName()}`);\r\n        this.state = CurrentSocketState.CONNECTING;\r\n        this.socket = new WebSocket(this.url);\r\n        this.lastDisconnect = 0;\r\n\r\n        this.socket.onclose = (evt) => {\r\n            console.info(`Connection reported onClose ${this.getName()}`);\r\n            if(this.connectionListener) this.connectionListener(false, evt.reason + \" - \" + evt.code);\r\n\r\n            this.lastDisconnect = Date.now();\r\n            this.state = CurrentSocketState.DISCONNECTED;\r\n            this.socket = undefined;\r\n            this.currentData = \"\";\r\n        }\r\n\r\n        this.socket.onopen = ev => {\r\n            console.info(`Connection reports onOpen ${this.getName()}`);\r\n            this.state = CurrentSocketState.CONNECTED;\r\n            if(this.connectionListener) this.connectionListener(true, \"\");\r\n        };\r\n\r\n        this.socket.onmessage = ev => {\r\n            this.currentData += ev.data;\r\n            let possibleMessage = this.getPossibleMessage(PROTOCOL_TAG_VAL);\r\n            while(possibleMessage && this.messageHandler) {\r\n                try {\r\n                    console.debug(`Message received on ${this.getName()} was ${possibleMessage}`);\r\n                    this.messageHandler(PROTOCOL_TAG_VAL, possibleMessage);\r\n                }\r\n                catch(e) {\r\n                    console.log(\"Unexpected error in message processing\");\r\n                    console.log(e);\r\n                }\r\n                possibleMessage = this.getPossibleMessage(PROTOCOL_TAG_VAL); // check if there's a tag val message\r\n            }\r\n        };\r\n    }\r\n\r\n    lastDisconnectTime(): number {\r\n        return this.lastDisconnect;\r\n    }\r\n\r\n    getPossibleMessage(protocol: number): string|undefined {\r\n        if (this.state !== CurrentSocketState.CONNECTED || !this.currentData) return undefined;\r\n        let position = 0;\r\n\r\n        while(position < this.currentData.length && this.currentData.charCodeAt(position) !== TAG_START_OF_MSG) position++;\r\n        position++; // skip message start\r\n        if(position >= this.currentData.length || this.currentData.charCodeAt(position) !== protocol) return undefined;\r\n        let msgStart = position + 1;\r\n        while(position < this.currentData.length && this.currentData.charCodeAt(position) !== TAG_END_OF_MSG) position++;\r\n        if(this.currentData.charCodeAt(position) !== TAG_END_OF_MSG) return undefined;\r\n        let retVal = this.currentData.substring(msgStart, position);\r\n        this.currentData = this.currentData.substring(position + 1);\r\n        return retVal;\r\n    }\r\n\r\n    stop(): void {\r\n        this.state = CurrentSocketState.STOPPED;\r\n        this.socket?.close();\r\n    }\r\n\r\n    closeConnection(): void {\r\n        console.info(`closeConnection on ${this.getName()}`);\r\n        this.state = CurrentSocketState.DISCONNECTED;\r\n        this.socket?.close();\r\n    }\r\n\r\n    getName(): string {\r\n        return `WebSocket(${this.url})`;\r\n    }\r\n\r\n    isConnected(): boolean {\r\n        return this.socket?.readyState === WebSocket.OPEN;\r\n    }\r\n\r\n    registerConnectionListener(connectionListener: APIConnectionListener): void {\r\n        this.connectionListener = connectionListener;\r\n        connectionListener(this.socket?.readyState ===  WebSocket.OPEN, \"\");\r\n    }\r\n\r\n    registerMessageHandler(messageHandler: APIMessageHandler): void {\r\n        this.messageHandler = messageHandler;\r\n    }\r\n\r\n    sendMessage(rawMessage: string): void {\r\n        this.socket?.send(rawMessage);\r\n    }\r\n}","import {AppInfo, MenuController} from \"./api/MenuController\";\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport React, {Component, FormEvent} from \"react\";\r\n\r\nexport class GlobalAppSettings implements AppInfo {\r\n    private readonly SETTINGS_APP_NAME = \"settings_appName\";\r\n    private readonly SETTINGS_APP_UUID = \"settings_appUUID\";\r\n    private readonly SETTINGS_WEBSOCKET_EXT = \"settings_webSocketExt\";\r\n\r\n    private uuid: string = uuidv4();\r\n    private appName: string = \"Untitled\";\r\n    private webSocketExtension: string = \"\";\r\n\r\n    constructor() {\r\n        if(doesCookieExist(this.SETTINGS_APP_NAME) && doesCookieExist(this.SETTINGS_APP_UUID)) {\r\n            this.appName = getCookieOrDefault(this.SETTINGS_APP_NAME) ?? \"Undefined\";\r\n            this.uuid = getCookieOrDefault(this.SETTINGS_APP_UUID) ?? \"Undefined\";\r\n            this.webSocketExtension = getCookieOrDefault(this.SETTINGS_WEBSOCKET_EXT) ?? \"\";\r\n        } else {\r\n            // we must save out the UUID on first run because otherwise we'd get a new one every time around\r\n            // and if authentication is enabled on device, we'd not be able to connect without pairing each time.\r\n            setCookie(this.SETTINGS_APP_UUID, this.uuid);\r\n            setCookie(this.SETTINGS_APP_NAME, this.appName);\r\n            setCookie(this.SETTINGS_WEBSOCKET_EXT, this.webSocketExtension);\r\n            setCookie(\"settings_appName\", \"Untitled\");\r\n        }\r\n    }\r\n\r\n    getAppName(): string {\r\n        return this.appName;\r\n    }\r\n\r\n    getAppUuid(): string {\r\n        return this.uuid;\r\n    }\r\n\r\n    getWebSocketExtension(): string {\r\n        return this.webSocketExtension;\r\n    }\r\n\r\n    setAppName(appName: string): void {\r\n        this.appName = appName;\r\n        setCookie(this.SETTINGS_APP_NAME, appName);\r\n    }\r\n\r\n    setAppUuid(appUuid: string): void {\r\n        this.uuid = appUuid;\r\n        setCookie(this.SETTINGS_APP_UUID, appUuid);\r\n    }\r\n\r\n    setWebSocketExtension(wsExtension: string) {\r\n        this.webSocketExtension = wsExtension;\r\n        setCookie(this.SETTINGS_WEBSOCKET_EXT, wsExtension);\r\n    }\r\n}\r\n\r\nexport class GlobalSettingsPanel extends Component<{settings: GlobalAppSettings, controller: MenuController}, string> {\r\n    constructor(props: {settings: GlobalAppSettings, controller: MenuController}) {\r\n        super(props);\r\n        this.appNameHasChanged = this.appNameHasChanged.bind(this);\r\n        this.appUuidHasChanged = this.appUuidHasChanged.bind(this);\r\n        this.webSocketHasChanged = this.webSocketHasChanged.bind(this);\r\n        this.formSubmitPrevention = this.formSubmitPrevention.bind(this);\r\n    }\r\n\r\n    public appNameHasChanged(event: React.FormEvent<HTMLInputElement>) {\r\n        this.props.settings.setAppName(event.currentTarget.value);\r\n        this.forceUpdate();\r\n    }\r\n\r\n    public appUuidHasChanged() {\r\n        this.props.settings.setAppUuid(uuidv4());\r\n        this.forceUpdate();\r\n    }\r\n\r\n    public webSocketHasChanged(event: React.FormEvent<HTMLInputElement>) {\r\n        this.props.settings.setWebSocketExtension(event.currentTarget.value);\r\n        this.forceUpdate();\r\n    }\r\n\r\n    public formSubmitPrevention(e: FormEvent) {\r\n        e.preventDefault();\r\n    }\r\n\r\n    public render() {\r\n        return <div>\r\n            <h1>Global Settings</h1>\r\n            <form className=\"settingsForm\" onSubmit={this.formSubmitPrevention}>\r\n                <label htmlFor=\"appNameField\">App Name</label>\r\n                <span><input id=\"appNameField=\" name=\"appName\" onChange={this.appNameHasChanged} value={this.props.settings.getAppName()}/></span>\r\n                <label htmlFor=\"appUuidField\">App UUID</label>\r\n                <button onClick={this.appUuidHasChanged}>\r\n                    <i className=\"fa fa-refresh\"/>\r\n                </button>\r\n                <span><input type=\"text\" id=\"appUuidField\" readOnly name=\"appUuid\" value={this.props.settings.getAppUuid()}/></span>\r\n                <h2>Advanced / Dev settings</h2>\r\n                <label htmlFor=\"websocketAddressField\">Web Socket</label>\r\n                <span><input id=\"websocketAddressField\" name=\"webSockField\" onChange={this.webSocketHasChanged} value={this.props.settings.getWebSocketExtension()}/></span>\r\n            </form>\r\n            <p>{process.env.REACT_APP_NAME} Version {process.env.REACT_APP_VERSION}</p>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport function setCookie(key: string, value: string) {\r\n    const expires = new Date();\r\n    expires.setTime(expires.getTime() + (365 * 24 * 60 * 60 * 1000));\r\n    document.cookie = key + '=' + value + ';path=/;expires=' + expires.toUTCString();\r\n}\r\n\r\nexport function getCookieOrDefault(name: string, def: string|undefined = undefined) : string|undefined {\r\n    const nameLenPlus = (name.length + 1);\r\n    return document.cookie\r\n        .split(';')\r\n        .map(c => c.trim())\r\n        .filter(cookie => { return cookie.substring(0, nameLenPlus) === `${name}=`; })\r\n        .map(cookie => { return decodeURIComponent(cookie.substring(nameLenPlus)); })[0] || def;\r\n}\r\n\r\nexport function doesCookieExist(name: string): boolean {\r\n    return getCookieOrDefault(name) !== undefined;\r\n}\r\n","import React, {Component} from 'react';\r\nimport logo from './img/large_icon.webp';\r\nimport './App.css';\r\nimport {MenuController} from \"./api/MenuController\";\r\nimport {RootSubMenuUI} from \"./MenuUI\"\r\nimport {WebSocketConnector} from \"./api/remote/WebSocketConnector\";\r\nimport {ButtonType} from \"./api/protocol/TagValEnums\";\r\nimport {GlobalAppSettings, GlobalSettingsPanel} from \"./GlobalSettings\";\r\n\r\nclass App extends Component<any, {settingsActive: boolean}> {\r\n  private static globalSettings: GlobalAppSettings = new GlobalAppSettings();\r\n  private static globalController: MenuController;\r\n  private static globalSocket: WebSocketConnector\r\n  private static hasStartedYet = false;\r\n\r\n  constructor(props:any) {\r\n    super(props);\r\n    this.state = {settingsActive: false};\r\n    this.settingsButtonWasPressed = this.settingsButtonWasPressed.bind(this);\r\n\r\n    try {\r\n      if (!App.hasStartedYet) {\r\n        App.hasStartedYet = true;\r\n        let customUrl = App.globalSettings.getWebSocketExtension();\r\n        App.globalSocket = new WebSocketConnector(customUrl.length ? customUrl : \"ws://\" + window.location.host + \"/ws\");\r\n        App.globalController = new MenuController(App.globalSocket, App.globalSettings);\r\n        App.globalController.start();\r\n      }\r\n    } catch (err) {\r\n      if (err instanceof Error) console.log(err.message);\r\n      console.log(err);\r\n    }\r\n  }\r\n\r\n  settingsButtonWasPressed() {\r\n    const st = !this.state.settingsActive;\r\n    this.setState({settingsActive: st});\r\n  }\r\n\r\n  render() {\r\n    if(this.state && this.state.settingsActive) {\r\n      return  <div className=\"App\">\r\n        <header className=\"App-header\">\r\n          <button onClick={this.settingsButtonWasPressed} className=\"settingsButton\"><i className=\"fa fa-close\"/> </button>\r\n          <img src={logo} className=\"App-logo\" alt=\"logo\"/>\r\n          <p>\r\n            App Settings\r\n          </p>\r\n        </header>\r\n        <GlobalSettingsPanel settings={App.globalSettings} controller={App.globalController}/>\r\n      </div>\r\n\r\n    } \r\n    return (\r\n        <div className=\"App\">\r\n          <header className=\"App-header\">\r\n            <button onClick={this.settingsButtonWasPressed} className=\"settingsButton\"><i className=\"fa fa-cog\"/></button>\r\n            <img src={logo} className=\"App-logo\" alt=\"logo\"/>\r\n            <p>embedCONTROL {process.env.REACT_APP_VERSION}</p>\r\n          </header>\r\n          <DialogItemUI controller={App.globalController}/>\r\n          <RootSubMenuUI itemId=\"0\" controller={App.globalController}/>\r\n        </div>\r\n    );\r\n  }\r\n}\r\n\r\ninterface DialogState {\r\n  shown: boolean;\r\n  title: string;\r\n  content: string;\r\n  button1: ButtonType;\r\n  button2: ButtonType;\r\n}\r\n\r\nclass DialogItemUI extends Component<{ controller: MenuController}, DialogState> {\r\n\r\n  constructor(props: {controller: MenuController}) {\r\n    super(props);\r\n    props.controller.registerDialogListener((shown: boolean, title: string, content: string, btn1: ButtonType, btn2: ButtonType) => {\r\n      this.setState({title: title, content: content, button1: btn1, button2: btn2, shown: shown});\r\n    });\r\n    this.button1Clicked = this.button1Clicked.bind(this);\r\n    this.button2Clicked = this.button2Clicked.bind(this);\r\n  }\r\n\r\n  textFromBtnType(btn: ButtonType) {\r\n    switch(btn) {\r\n      case ButtonType.ACCEPT: return \"Accept\";\r\n      case ButtonType.CANCEL: return \"Cancel\";\r\n      case ButtonType.OK: return \"OK\";\r\n      case ButtonType.CLOSE: return \"Close\";\r\n      default: return \"\";\r\n    }\r\n  }\r\n\r\n  button1Clicked() {\r\n    this.props.controller.sendDialogAction(this.state.button1);\r\n  }\r\n\r\n  button2Clicked() {\r\n    this.props.controller.sendDialogAction(this.state.button2);\r\n  }\r\n\r\n  render() {\r\n    const dialogClasses = this.state?.shown ? \"dialogShown\" : \"dialogHidden\"\r\n    if (!this.state) return <div/>\r\n\r\n    return <div className={dialogClasses}>\r\n      <h1>{this.state.title}</h1>\r\n      <h3>{this.state.content}</h3>\r\n      <div>\r\n        <button onClick={this.button1Clicked}>{this.textFromBtnType(this.state.button1)}</button>\r\n        <button onClick={this.button2Clicked}>{this.textFromBtnType(this.state.button2)}</button>\r\n      </div>\r\n    </div>\r\n  }\r\n}\r\n\r\nexport default App;\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}