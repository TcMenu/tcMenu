# Windows
# Prerequisites: Ensure all components are correctly versioned in Maven, iss script etc.
#
# Step 1 - Check the archive worked and versioning is right
#

Run and smoke test:
java --module-path ../deps --enable-preview -Dprism.lcdtext=false --add-modules com.thecoderscorner.tcmenu.menuEditorUI com.thecoderscorner.menu.editorui.cli.TcMenuDesignerCmd

# Step 2 - Build the package - Windows all versions

jpackage --type app-image -n tcMenuDesigner -p jfx/deps --input jfx/app --resource-dir .\classes\img\ --icon tcMenuDesigner.ico --app-version 2.1.0-beta1 --verbose --java-options "--enable-preview -Dprism.lcdtext=false" -m com.thecoderscorner.tcmenu.menuEditorUI/com.thecoderscorner.menu.editorui.cli.TcMenuDesignerCmd

# Step 3 - Build the distribution

Go to Inno Setup Compiler, choose designerscript.iss from the tcMenuGenerator directory. Choose compile, output will be in the Output directory at the same level as the script.

# Step 4 - Build for Debian / Ubunutu using package command

jpackage -n tcMenuDesigner -p jfx/deps --input jfx/app --icon ./classes/img/menu-icon.png --verbose --license-file ../../LICENSE --linux-app-category Development --linux-menu-group "Development;Utility;" --java-options "--enable-preview -Dprism.lcdtext=false" --app-version 2.1.0-beta1 -m com.thecoderscorner.tcmenu.menuEditorUI/com.thecoderscorner.menu.editorui.cli.TcMenuDesignerCmd

# Step 5 - MacOS build all versions

Perform maven build

jpackage -n tcMenuDesigner -p jfx/deps --input jfx/app --icon ./classes/img/AppIcon.icns --verbose --license-file ../../LICENSE --vendor TheCodersCorner --app-version 2.1.0 --java-options "--enable-preview -Dprism.lcdtext=false" --verbose -m com.thecoderscorner.tcmenu.menuEditorUI/com.thecoderscorner.menu.editorui.cli.TcMenuDesignerCmd

To allow for CLI on macOS: alias tcmenu=/Applications/tcMenuDesigner.app/Contents/MacOS/tcMenuDesigner

# controller to be better defined at the moment.

jpackage --type app-image -n tcMenuController -p jfx/deps --input jfx/app --icon ./classes/img/Icon.icns --vendor TheCodersCorner --verbose -m com.thecoderscorner.tcmenu.exampleui/com.thecoderscorner.menu.editorui.cli.TcMenuDesignerCmd

#------------------------------------------------------------------------
#------------------------------------------------------------------------
#---------------------------OLD INSTRUCTIONS-----------------------------
#------------------------------------------------------------------------
#------------------------------------------------------------------------

--- old instructions for JDK 11 (before 1.4.1 basically) DO NOT USE FOR NEWER BUILDS


!!todo next version - update to latest gson that has module file.

jdeps --generate-module-info . .\gson-2.8.5.jar
mv gson/module-info.java .
javac --patch-module gson=gson-2.8.5.jar module-info.java
mv gson/module-info.class gson
jar -uf .\gson-2.8.5.jar -C gson module-info.class
jar tvf .\gson-2.8.5.jar | findstr module

#
# Step 2 after maven build - try running as a java app direct from jfx/deps directory (java 11):
#

java --module-path . --add-modules com.thecoderscorner.tcmenu.menuEditorUI com.thecoderscorner.menu.editorui.MenuEditorApp

#
# windows java 11 packager to create an image -
# 1. start in target dir
# 2. replace all version numbers before starting.
#

jpackager create-image --output tcMenuDesigner --input jfx/app --name tcMenuDesigner --module-path jfx/deps --add-modules com.thecoderscorner.tcmenu.menuEditorUI --version 1.5.0 --icon classes/img/tcMenuDesigner.ico --identifier com.thecoderscorner.menu.editorui --vendor TheCodersCorner --jvm-args "-Djava.util.logging.config.file=logging.properties" --verbose -m com.thecoderscorner.tcmenu.menuEditorUI/com.thecoderscorner.menu.editorui.MenuEditorApp

# in the example UI directory

jpackager create-image --output tcMenuController --input jfx/app --name tcMenuController --module-path jfx/deps --add-modules com.thecoderscorner.tcmenu.exampleui --version 1.5.0 --icon classes/controller-icon.ico --identifier com.thecoderscorner.tcmenu.exampleui --vendor TheCodersCorner --jvm-args "-Djava.util.logging.config.file=logging.properties" --verbose -m com.thecoderscorner.tcmenu.exampleui/com.thecoderscorner.menu.controller.MenuControllerApp

Copy the plugins into the tcMenuDesigner/app dir at the same level as embedded.

Move the inno setup for windows into target/tcMenuDesigner folder, and then run the setup

Rename the setup.exe to setupTcMenu.exe (setup.exe is unsafe)

Job done on windows!

#
# MacOS package
#

change to designer target directory.

cp classes/img/Icon.icns tcMenuDesigner.icns

$JAVA_HOME/bin/jpackage --input jfx/app --name tcMenuDesigner --module-path jfx/deps --vendor TheCodersCorner  --add-modules com.thecoderscorner.tcmenu.menuEditorUI --verbose --app-version 1.5.0 --icon tcMenuDesigner.icns -m com.thecoderscorner.tcmenu.menuEditorUI/com.thecoderscorner.menu.editorui.MenuEditorApp

$JAVA_HOME/bin/jpackage --input jfx/app --name tcMenuController --module-path jfx/deps --add-modules com.thecoderscorner.tcmenu.exampleui --app-version 1.5.0 --icon tcMenuController.icns --vendor TheCodersCorner --verbose -m com.thecoderscorner.tcmenu.exampleui/com.thecoderscorner.menu.controller.MenuControllerApp

add the plugins to the .app file in the same directory as embedded.

Create a new diskimage and open called tcMenuDesigner-<version>.dmg with name tcMenuDesigner
Open shell in that directory

Shell: cp /Users/dave/IdeaProjects/tcMenu/tcMenuGenerator/macos-diskimg.png logo.png

From Popup menu -> View Settings: Change the background to the logo. Resize the window, select icon view as default. Scale icons to 88px

Shell: mv logo.png .logo.png

Finder window: Drag in the application and Alt-Cmd drag Applications to make a link.

Unmount the disk and open disk utility, and then choose convert. Make a compressed disk image. Job done on macos.
